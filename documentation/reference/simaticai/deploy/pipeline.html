<!--
  SPDX-FileCopyrightText: 2025 (C) 2025 Siemens AG
  SPDX-License-Identifier: MIT
-->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.5.0">
    
    
      
        <title>Pipeline - AI Software Development Kit</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2e8b5541.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../styles.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-simaticaideploypipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="AI Software Development Kit" class="md-header__button md-logo" aria-label="AI Software Development Kit" data-md-component="logo">
      
  <img src="../../../Sie_logo_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI Software Development Kit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pipeline
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="AI Software Development Kit" class="md-nav__button md-logo" aria-label="AI Software Development Kit" data-md-component="logo">
      
  <img src="../../../Sie_logo_white.svg" alt="logo">

    </a>
    AI Software Development Kit
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG.html" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../user_manual.html" class="md-nav__link">
        User Manual
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Log Module
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Log Module" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Log Module
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../log_module/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../log_module/mock_logger.html" class="md-nav__link">
        Mock Logger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Simaticai
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Simaticai" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Simaticai
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployment.html" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../model_config_pb2.html" class="md-nav__link">
        Model Config Pb2
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_4" type="checkbox" id="__nav_4_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_4">
          Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_4">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/schemas.html" class="md-nav__link">
        Schemas
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_5" type="checkbox" id="__nav_4_2_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_5">
          Deploy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deploy" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_5">
          <span class="md-nav__icon md-icon"></span>
          Deploy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="component.html" class="md-nav__link">
        Component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="gpuruntime_component.html" class="md-nav__link">
        Gpuruntime Component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Pipeline
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="pipeline.html" class="md-nav__link md-nav__link--active">
        Pipeline
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_generate_runtime_config" class="md-nav__link">
    _generate_runtime_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_package_component" class="md-nav__link">
    _package_component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_package_component_dependencies" class="md-nav__link">
    _package_component_dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_validate_with_schema" class="md-nav__link">
    _validate_with_schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert_package" class="md-nav__link">
    convert_package
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline" class="md-nav__link">
    Pipeline
  </a>
  
    <nav class="md-nav" aria-label="Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_components" class="md-nav__link">
    from_components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_component" class="md-nav__link">
    add_component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_dependencies" class="md-nav__link">
    add_dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_input" class="md-nav__link">
    add_input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_output" class="md-nav__link">
    add_output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_parameter" class="md-nav__link">
    add_parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_timeshifting_reference" class="md-nav__link">
    add_timeshifting_reference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_wiring" class="md-nav__link">
    add_wiring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_input" class="md-nav__link">
    delete_input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_input_wire" class="md-nav__link">
    delete_input_wire
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_output" class="md-nav__link">
    delete_output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export" class="md-nav__link">
    export
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_datalink_metadata" class="md-nav__link">
    get_datalink_metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_pipeline_config" class="md-nav__link">
    get_pipeline_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_wire_for_input" class="md-nav__link">
    get_wire_for_input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_wire_for_output" class="md-nav__link">
    get_wire_for_output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove_timeshifting_reference" class="md-nav__link">
    remove_timeshifting_reference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_datalink_metadata" class="md-nav__link">
    save_datalink_metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_pipeline_config" class="md-nav__link">
    save_pipeline_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_telemetry_data" class="md-nav__link">
    save_telemetry_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_timeshifting_periodicity" class="md-nav__link">
    set_timeshifting_periodicity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    validate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="pipeline_data.html" class="md-nav__link">
        Pipeline Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="pipeline_page.html" class="md-nav__link">
        Pipeline Page
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="python_component.html" class="md-nav__link">
        Python Component
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_6" type="checkbox" id="__nav_4_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_6">
          Helpers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Helpers" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_6">
          <span class="md-nav__icon md-icon"></span>
          Helpers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/model_config.html" class="md-nav__link">
        Model Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/pep508.html" class="md-nav__link">
        Pep508
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/reporter.html" class="md-nav__link">
        Reporter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/tempfiles.html" class="md-nav__link">
        Tempfiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/yaml_helper.html" class="md-nav__link">
        Yaml Helper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_7" type="checkbox" id="__nav_4_2_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_7">
          Packaging
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Packaging" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_7">
          <span class="md-nav__icon md-icon"></span>
          Packaging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packaging/constants.html" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packaging/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packaging/python_dependencies.html" class="md-nav__link">
        Python Dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packaging/wheelhouse.html" class="md-nav__link">
        Wheelhouse
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_8" type="checkbox" id="__nav_4_2_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_8">
          Testing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Testing" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_8">
          <span class="md-nav__icon md-icon"></span>
          Testing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/component_runner.html" class="md-nav__link">
        Component Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/data_stream.html" class="md-nav__link">
        Data Stream
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/docker_venv.html" class="md-nav__link">
        Docker Venv
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/pipeline_runner.html" class="md-nav__link">
        Pipeline Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/pipeline_validator.html" class="md-nav__link">
        Pipeline Validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/run_component.html" class="md-nav__link">
        Run Component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/run_gpuruntime_component.html" class="md-nav__link">
        Run Gpuruntime Component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/runner_config.html" class="md-nav__link">
        Runner Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/timeseries_stream.html" class="md-nav__link">
        Timeseries Stream
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testing/vca_stream.html" class="md-nav__link">
        Vca Stream
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_generate_runtime_config" class="md-nav__link">
    _generate_runtime_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_package_component" class="md-nav__link">
    _package_component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_package_component_dependencies" class="md-nav__link">
    _package_component_dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_validate_with_schema" class="md-nav__link">
    _validate_with_schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert_package" class="md-nav__link">
    convert_package
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline" class="md-nav__link">
    Pipeline
  </a>
  
    <nav class="md-nav" aria-label="Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from_components" class="md-nav__link">
    from_components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_component" class="md-nav__link">
    add_component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_dependencies" class="md-nav__link">
    add_dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_input" class="md-nav__link">
    add_input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_output" class="md-nav__link">
    add_output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_parameter" class="md-nav__link">
    add_parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_timeshifting_reference" class="md-nav__link">
    add_timeshifting_reference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add_wiring" class="md-nav__link">
    add_wiring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_input" class="md-nav__link">
    delete_input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_input_wire" class="md-nav__link">
    delete_input_wire
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_output" class="md-nav__link">
    delete_output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export" class="md-nav__link">
    export
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_datalink_metadata" class="md-nav__link">
    get_datalink_metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_pipeline_config" class="md-nav__link">
    get_pipeline_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_wire_for_input" class="md-nav__link">
    get_wire_for_input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_wire_for_output" class="md-nav__link">
    get_wire_for_output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove_timeshifting_reference" class="md-nav__link">
    remove_timeshifting_reference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_datalink_metadata" class="md-nav__link">
    save_datalink_metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_pipeline_config" class="md-nav__link">
    save_pipeline_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_telemetry_data" class="md-nav__link">
    save_telemetry_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_timeshifting_periodicity" class="md-nav__link">
    set_timeshifting_periodicity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validate" class="md-nav__link">
    validate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="module-simaticaideploypipeline">Module simaticai.deploy.pipeline</h1>
<p>None</p>
<p>None</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="c1"># Copyright (C) Siemens AG 2021. All Rights Reserved. Confidential.</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">importlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">resources</span> <span class="k">as</span> <span class="n">module_resources</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jsonschema</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jsonschema.exceptions</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pkg_resources</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.deploy.component</span><span class="w"> </span><span class="kn">import</span> <span class="n">Component</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.deploy.python_component</span><span class="w"> </span><span class="kn">import</span> <span class="n">PythonComponent</span><span class="p">,</span> <span class="n">python_version_validator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.deploy.pipeline_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineData</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">simaticai.deploy.pipeline_page</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">p_page</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">tempfiles</span><span class="p">,</span> <span class="n">yaml_helper</span><span class="p">,</span> <span class="n">calc_sha</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.packaging.constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>

    <span class="n">PIPELINE_CONFIG</span><span class="p">,</span> <span class="n">RUNTIME_CONFIG</span><span class="p">,</span> <span class="n">DATALINK_METADATA</span><span class="p">,</span>  <span class="c1"># pipeline configuration files</span>

    <span class="n">TELEMETRY_YAML</span><span class="p">,</span> <span class="n">README_HTML</span><span class="p">,</span>  <span class="c1"># additional pipeline information files</span>

    <span class="n">REQUIREMENTS_TXT</span><span class="p">,</span> <span class="n">PYTHON_PACKAGES_ZIP</span><span class="p">,</span>  <span class="c1"># component dependency configuration</span>

    <span class="n">PYTHON_PACKAGES</span><span class="p">,</span> <span class="n">MSG_NOT_FOUND</span><span class="p">,</span>  <span class="c1"># additional constants</span>

    <span class="n">PIPELINE_SIZE_LIMIT</span>

<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.packaging.wheelhouse</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_wheelhouse</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.helpers.reporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineReportWriter</span><span class="p">,</span> <span class="n">ReportWriterHandler</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.packaging.python_dependencies</span><span class="w"> </span><span class="kn">import</span> <span class="n">_logger</span> <span class="k">as</span> <span class="n">_python_dependencies_logger</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simaticai.packaging.wheelhouse</span><span class="w"> </span><span class="kn">import</span> <span class="n">_logger</span> <span class="k">as</span> <span class="n">_wheelhouse_logger</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)]</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>

    <span class="s1">&#39;Pipeline&#39;</span><span class="p">,</span>

    <span class="s1">&#39;convert_package&#39;</span><span class="p">,</span>

    <span class="s1">&#39;_validate_with_schema&#39;</span><span class="p">,</span>

    <span class="s1">&#39;_package_component&#39;</span><span class="p">,</span>

    <span class="s1">&#39;_package_component_dependencies&#39;</span><span class="p">,</span>

    <span class="s1">&#39;_generate_runtime_config&#39;</span>

<span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pipeline</span><span class="p">(</span><span class="n">PipelineData</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    `Pipeline` represents a pipeline configuration package with `Components` and wires to provide a data flow on the AI Inference Server.</span>

<span class="sd">    The `Components` have inputs and outputs to transfer data to each other and the wires describe this data flow between them.</span>

<span class="sd">    The package also contains configuration files required to deploy a pipeline on an Industrial Edge device.</span>

<span class="sd">    A newly initialized `Pipeline` does not contain any `Component` or wire, only its name and version will be set.</span>

<span class="sd">    The name and version together will define the name of the zip file when the package is saved.</span>

<span class="sd">    Args:</span>

<span class="sd">        name (str): Name of the package</span>

<span class="sd">        version (str): Version of the package</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_wire_hash_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2"> -&gt; </span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        A newly initialized `Pipeline` will contain no `Component` or wire, just its name and version will be set.</span>

<span class="sd">        The name and version will define together the name of the zip file when the package is saved.</span>

<span class="sd">        Args:</span>

<span class="sd">            name (str): Name of the package</span>

<span class="sd">            desc (str): Package description (optional)</span>

<span class="sd">            version (str): Version of the package</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span> <span class="o">=</span> <span class="n">PipelineReportWriter</span><span class="p">()</span>

        <span class="n">report_writer_handler</span> <span class="o">=</span> <span class="n">ReportWriterHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="p">)</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">report_writer_handler</span><span class="p">)</span>

        <span class="n">_python_dependencies_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">report_writer_handler</span><span class="p">)</span>

        <span class="n">_wheelhouse_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">report_writer_handler</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_log_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">log_level</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_components</span><span class="p">(</span><span class="n">components</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pipeline&quot;</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Creates a pipeline configuration from the given components.</span>

<span class="sd">        The components are linked in a linear sequence with inputs and outputs auto-wired based on the name of the inputs and outputs of the components.</span>

<span class="sd">        The inputs of the first component will be wired as the pipeline inputs and the outputs of the last component will be wired as the pipeline outputs.</span>

<span class="sd">        The components must have unique names. Two or more versions of the same component can not be packaged simultaneously without renaming them.</span>

<span class="sd">        Args:</span>

<span class="sd">            components (list): List of PythonComponents</span>

<span class="sd">            name (str): Name of the pipeline</span>

<span class="sd">            version (str): Version information of the pipeline. (Optional)</span>

<span class="sd">        Returns:</span>

<span class="sd">            Pipeline: Pipeline object with the auto-wired components</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">)</span>

        <span class="n">first_component</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">first_component</span><span class="p">)</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">component_input</span><span class="p">)</span> <span class="k">for</span> <span class="n">component_input</span> <span class="ow">in</span> <span class="n">first_component</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">first_component</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

            <span class="n">pipeline</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">wire_component</span><span class="p">,</span> <span class="n">wire_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="n">pipeline</span><span class="o">.</span><span class="n">add_wiring</span><span class="p">(</span><span class="n">wire_component</span><span class="p">,</span> <span class="n">wire_name</span><span class="p">,</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">wire_name</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                    <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output variable </span><span class="si">{</span><span class="n">wire_component</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">wire_name</span><span class="si">}</span><span class="s2"> couldn&#39;t be auto-wired.</span><span class="se">\n</span><span class="s2">Cause: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">unwired_variables</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">inputs</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">wiring</span><span class="p">)]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unwired_variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">unwired_variables</span><span class="p">:</span>

                    <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input variable </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> couldn&#39;t be auto-wired.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">pipeline</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pipeline</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Textual representation of the configured package.</span>

<span class="sd">        The method shows the `Components` with their inputs, outputs and parameters as well as the wiring between these `Components`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            [str]: Textual representation of the package</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pipeline Parameters:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, default: &#39;</span><span class="si">{</span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;defaultValue&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;)</span><span class="si">{</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">parameter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pipeline Inputs:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

                <span class="nb">input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&gt; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pipeline Outputs:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">component_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">PythonComponent</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metrics:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt; </span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">metric</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">I/O Wiring:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">wire_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">:</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">wire_hash</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">component_name</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Timeshifting:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  Periodicity: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="si">}</span><span class="s2"> ms</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;  References:</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

                    <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">component</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Defines an input variable on the given component as a pipeline input.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The component with input variable must exist in the pipeline.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline input already exists.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes a pipeline input.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline input does not exist.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Defines an output variable on the given component as a pipeline output.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the output variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The component with output variable must exist in the pipeline.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline output already exists.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes a pipeline output.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline output does not exist.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Adds a `Component` to the pipeline configuration without any connection.</span>

<span class="sd">        The `Component` can be marked as an input or output component of the pipeline.</span>

<span class="sd">        When these parameters are True, the `Component` is responsible for input or output data of the pipeline.</span>

<span class="sd">        The component must have a unique name. Two or more versions of the same component can not be added to the same pipeline with the same component name.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (Component): `Component` to be added</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Component with name </span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists. Please rename the component.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">component</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_wiring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">from_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Creates a one-to-one connection between the input and output of two components.</span>

<span class="sd">        The method checks if the connection is allowed with the following requirements:</span>

<span class="sd">        - The components exist with the given inputs/outputs</span>

<span class="sd">        - The given inputs and outputs are not connected to any wire</span>

<span class="sd">        - The types of the connected input and output are compatible</span>

<span class="sd">        Args:</span>

<span class="sd">            from_component (str): Name of the component which provides data to the `to_component`</span>

<span class="sd">            from_output (str): Name of the output variable of the `from_component`</span>

<span class="sd">            to_component (str): Name of the component which consumes data from the `from_component`</span>

<span class="sd">            to_input (str): Name of the input variable of the `to_component`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">from_component</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No component named &#39;</span><span class="si">{</span><span class="n">from_component</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_component</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No component named &#39;</span><span class="si">{</span><span class="n">to_component</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">from_component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Component &#39;</span><span class="si">{</span><span class="n">from_component</span><span class="si">}</span><span class="s2">&#39; has no output named &#39;</span><span class="si">{</span><span class="n">from_output</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_input</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">to_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Component &#39;</span><span class="si">{</span><span class="n">to_component</span><span class="si">}</span><span class="s2">&#39; has no input named &#39;</span><span class="si">{</span><span class="n">to_input</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">to_component</span><span class="p">,</span> <span class="n">to_input</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input &#39;</span><span class="si">{</span><span class="n">to_input</span><span class="si">}</span><span class="s2">&#39; of component &#39;</span><span class="si">{</span><span class="n">to_component</span><span class="si">}</span><span class="s2">&#39; is already wired&quot;</span><span class="p">)</span>

        <span class="n">_output_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">from_component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">from_output</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="n">_input_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">to_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">to_input</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">_output_type</span> <span class="o">!=</span> <span class="n">_input_type</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Output and input types do not match&quot;</span><span class="p">)</span>

        <span class="n">wire_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wire_hash_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_component</span><span class="p">,</span> <span class="n">from_output</span><span class="p">,</span> <span class="n">to_component</span><span class="p">,</span> <span class="n">to_input</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">[</span><span class="n">wire_hash</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s2">&quot;fromComponent&quot;</span><span class="p">:</span> <span class="n">from_component</span><span class="p">,</span>

            <span class="s2">&quot;fromOutput&quot;</span><span class="p">:</span> <span class="n">from_output</span><span class="p">,</span>

            <span class="s2">&quot;toComponent&quot;</span><span class="p">:</span> <span class="n">to_component</span><span class="p">,</span>

            <span class="s2">&quot;toInput&quot;</span><span class="p">:</span> <span class="n">to_input</span><span class="p">,</span>

        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_wire_for_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Searches for the wire which connects a component with `component_name` as data provider through its output with name output_name.</span>

<span class="sd">        Args:</span>

<span class="sd">            component_name (str): Name of the data provider component.</span>

<span class="sd">            output_name (str): Name of the output variable of `component_name`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            [dict]: Wire which contains the data provider and receiver with their names and the names of their variables.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wires</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;fromComponent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">component_name</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;fromOutput&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">output_name</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">wires</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">wires</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_wire_for_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Searches for the wire which connects a component with `component_name` as data consumer through its input with name `input_name`.</span>

<span class="sd">        Args:</span>

<span class="sd">            component_name (str): Name of the data consumer component.</span>

<span class="sd">            input_name (str): Name of the input variable of `component_name`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            dict: Wire which contains the data provider and receiver with their names and the names of their variables.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wires</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;toComponent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">component_name</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;toInput&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">input_name</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">wires</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">wires</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_input_wire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">with_input</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes an existing connection between two components.</span>

<span class="sd">        The connection must be given with the name of the consumer component and its input variable.</span>

<span class="sd">        If an inter signal alignment reference variable is affected it cannot be deleted.</span>

<span class="sd">        By default, the input variable will be also deleted.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component which has the input given the name variable</span>

<span class="sd">            variable (str): Name of the input variable on the component which connected by the wire</span>

<span class="sd">            with_input (bool, optional): If set, the input variable will be also deleted from the component. Defaults to True.</span>

<span class="sd">        Raises:</span>

<span class="sd">            AssertionError: When the variable acts as inter signal alignment reference, it cannot be deleted, and an `AssertionError` will be raised.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wire</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wire</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no wiring for input &#39;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&#39; of component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Inter signal alignment reference variables can not be deleted.&quot;</span><span class="p">)</span>

        <span class="n">wire_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wire_hash_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">],</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">],</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">],</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wire_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_input</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">delete_input</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packages</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        @Deprecated, reason: components can have different Python versions and/or platform, therefore it&#39;s better to specify dependencies on a case-by-case basis.</span>

<span class="sd">        Collects the given Python packages with their versions from the executing Python environment and add them to all components of type `PythonComponent`.</span>

<span class="sd">        This step is necessary in order to execute the pipeline configuration on the Edge side.</span>

<span class="sd">        The method can be called multiple times but each time the previously-collected dependencies are cleared.</span>

<span class="sd">        The reason for this is to ensure a consistent dependency list for the `requirements.txt` file when the package is saved.</span>

<span class="sd">        Args:</span>

<span class="sd">            packages (list): List of the necessary python packages to execute the script defined by self.entrypoint</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">python_components</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="ow">is</span> <span class="n">PythonComponent</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">python_components</span><span class="p">:</span>

            <span class="n">component</span><span class="o">.</span><span class="n">add_dependencies</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_timeshifting_periodicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periodicity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Enables inter-signal alignment with the given sampling period.</span>

<span class="sd">        With inter-signal alignment enabled, the AI Inference Server collects data for different input variables before it triggers the model.</span>

<span class="sd">        By default, `startingPoint` property is set to `First timestamp`, which means that inter-signal alignment is started at the</span>

<span class="sd">        first incoming value for any input variable.</span>

<span class="sd">        This property can be changed to `Signal reference` by adding inter-signal alignment reference variables</span>

<span class="sd">        via the `add_timeshifting_reference(..)` method. In this case, inter-signal alignment is started when the first value arrives</span>

<span class="sd">        for the defined input variables.</span>

<span class="sd">        Args:</span>

<span class="sd">            periodicity (int): Periodicity time in milliseconds for the AI Inference Server to perform inter-signal alignment. Valid range is [10, 2^31).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">periodicity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">periodicity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">periodicity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">))):</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Inter signal alignment periodicity must be an integer and in range [10, 2^31)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span> <span class="o">=</span> <span class="n">periodicity</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inter signal alignment periodicity has been set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_timeshifting_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Enables signal alignment mode `Signal reference` by declaring input variables as reference variables.</span>

<span class="sd">        Args:</span>

<span class="sd">            reference (str): Variable name to be added to `self.timeshift_reference` list.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no input variable defined with name &#39;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference variable with name &#39;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s2">&#39; has been already added.&quot;</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_timeshifting_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Removes previously-defined inter-signal alignment reference variables.</span>

<span class="sd">        If no reference variables remain, the `startingPoint` will be `First timestamp`.</span>

<span class="sd">        Args:</span>

<span class="sd">            reference (str): Variable name to be removed from `self.timeshift_reference` list.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference variable with name </span><span class="si">{</span><span class="s1">&#39;reference&#39;</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_pipeline_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Saves the information on the composed pipeline configuration package into a YAML file.</span>

<span class="sd">        This YAML file describes the components and the data flow between them for the AI Inference Server.</span>

<span class="sd">        The file is created in the `destination` folder with name `pipeline_config.yml`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

        <span class="n">filtered_pipeline_outputs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">component_name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;imageset&#39;</span><span class="p">]</span>

        <span class="n">metric_fields</span> <span class="o">=</span> <span class="p">[(</span><span class="n">component_name</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">PythonComponent</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="n">pipeline_inputs</span> <span class="o">=</span> <span class="p">[{</span>

            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>

            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

        <span class="n">pipeline_outputs</span> <span class="o">=</span> <span class="p">[{</span>

            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>

            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>

            <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filtered_pipeline_outputs</span><span class="p">]</span>

        <span class="n">pipeline_outputs</span> <span class="o">+=</span> <span class="p">[{</span>

            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">field</span><span class="p">,</span>

            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;String&#39;</span><span class="p">,</span>

            <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

            <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;/siemens/edge/aiinference/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/metrics/</span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">metric_fields</span><span class="p">]</span>

        <span class="n">pipeline_dag</span> <span class="o">=</span> <span class="p">[{</span>

            <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">wire</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

        <span class="n">pipeline_dag</span> <span class="o">+=</span> <span class="p">[{</span>

            <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Databus.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>

            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

        <span class="n">pipeline_dag</span> <span class="o">+=</span> <span class="p">[{</span>

            <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>

            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Databus.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filtered_pipeline_outputs</span><span class="p">]</span>

        <span class="n">pipeline_dag</span> <span class="o">+=</span> <span class="p">[{</span>

            <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>

            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Databus.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>

        <span class="p">}</span> <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">metric_fields</span><span class="p">]</span>

        <span class="n">config_yml_content</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s1">&#39;fileFormatVersion&#39;</span><span class="p">:</span> <span class="s1">&#39;1.2.0&#39;</span><span class="p">,</span>

            <span class="s1">&#39;dataFlowPipelineInfo&#39;</span><span class="p">:</span> <span class="p">{</span>

                <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>

                <span class="s1">&#39;createdOn&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>

                <span class="s1">&#39;dataFlowPipelineVersion&#39;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>

                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="k">else</span> <span class="s1">&#39;Created by AI SDK&#39;</span><span class="p">,</span>

                <span class="s1">&#39;projectName&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>

                <span class="s1">&#39;packageId&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>

            <span class="p">},</span>

            <span class="s1">&#39;dataFlowPipeline&#39;</span><span class="p">:</span> <span class="p">{</span>

                <span class="s1">&#39;components&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>

                <span class="s1">&#39;pipelineDag&#39;</span><span class="p">:</span> <span class="n">pipeline_dag</span><span class="p">,</span>

                <span class="s1">&#39;pipelineInputs&#39;</span><span class="p">:</span> <span class="n">pipeline_inputs</span><span class="p">,</span>

                <span class="s1">&#39;pipelineOutputs&#39;</span><span class="p">:</span> <span class="n">pipeline_outputs</span><span class="p">,</span>

            <span class="p">},</span>

            <span class="s1">&#39;packageType&#39;</span><span class="p">:</span> <span class="s1">&#39;full&#39;</span>

        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">config_yml_content</span><span class="p">[</span><span class="s2">&quot;dataFlowPipeline&quot;</span><span class="p">][</span><span class="s2">&quot;pipelineParameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">parameter</span><span class="p">[</span><span class="s2">&quot;topicBased&quot;</span><span class="p">]:</span>

                    <span class="n">config_yml_content</span><span class="p">[</span><span class="s2">&quot;dataFlowPipeline&quot;</span><span class="p">][</span><span class="s2">&quot;pipelineParameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>

                        <span class="s1">&#39;defaultValue&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;defaultValue&#39;</span><span class="p">],</span>

                        <span class="s1">&#39;topicBased&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;topicBased&#39;</span><span class="p">],</span> <span class="s1">&#39;valueTopic&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;valueTopic&#39;</span><span class="p">]</span>

                    <span class="p">})</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">config_yml_content</span><span class="p">[</span><span class="s2">&quot;dataFlowPipeline&quot;</span><span class="p">][</span><span class="s2">&quot;pipelineParameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>

                        <span class="s1">&#39;defaultValue&#39;</span><span class="p">:</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;defaultValue&#39;</span><span class="p">]</span>

                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">config_yml_content</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_pipeline_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Saves the information about the composed pipeline configuration package into a YAML file.</span>

<span class="sd">        This YAML file describes the components and the data flow between them for AI Inference Server.</span>

<span class="sd">        The file will be created in the `destination` folder with name `pipeline_config.yml`</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (path-like): Path of the `destination` directory.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="o">/</span> <span class="n">PIPELINE_CONFIG</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pipeline_config</span><span class="p">(),</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_datalink_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        The method generates metadata information based on available information.</span>

<span class="sd">        Returns:</span>

<span class="sd">            dict: Dictionary with the necessary information for the AI Inference Server.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">timeshifting</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

            <span class="s2">&quot;periodicity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="p">,</span>

            <span class="s2">&quot;startingPoint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">timeshifting</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">timeshifting</span><span class="p">[</span><span class="s2">&quot;startingPoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;First timestamp&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">timeshifting</span><span class="p">[</span><span class="s2">&quot;startingPoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Signal reference&#39;</span>

        <span class="n">exported_metadata</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s2">&quot;fileFormatVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>

            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

            <span class="s2">&quot;createdOn&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>

            <span class="s2">&quot;updatedOn&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>

            <span class="s2">&quot;timeShifting&quot;</span><span class="p">:</span> <span class="n">timeshifting</span><span class="p">,</span>

            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>

                <span class="p">{</span>

                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">_name</span><span class="p">,</span>

                    <span class="s1">&#39;mapping&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>

                    <span class="s1">&#39;timeShiftingReference&#39;</span><span class="p">:</span> <span class="n">_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">,</span>

                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">_name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

                <span class="p">}</span> <span class="k">for</span> <span class="n">_component</span><span class="p">,</span> <span class="n">_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>

            <span class="p">]</span>

        <span class="p">}</span>

        <span class="k">return</span> <span class="n">exported_metadata</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_datalink_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Saves metadata for pipeline input variables.</span>

<span class="sd">        This method saves metadata for the AI Inference Server into a YAML file.</span>

<span class="sd">        This metadata determines how the AI Inference Server feeds input to the pipeline, especially inter-signal alignment.</span>

<span class="sd">        The file is created in the `destination` folder with the name `datalink_metadata.yml`</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (path-like): Path of the destination directory.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="o">/</span> <span class="n">DATALINK_METADATA</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_datalink_metadata</span><span class="p">(),</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_telemetry_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Save telemetry data to a specified destination.</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (Path): The path where the telemetry data should be saved.</span>

<span class="sd">        Returns:</span>

<span class="sd">            None</span>

<span class="sd">        Raises:</span>

<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">telemetry_path</span> <span class="o">=</span> <span class="n">destination</span> <span class="o">/</span> <span class="n">TELEMETRY_YAML</span>

        <span class="n">telemetry_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">][</span><span class="s2">&quot;os&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">][</span><span class="s2">&quot;release&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">][</span><span class="s2">&quot;python_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;locals: </span><span class="si">{</span><span class="nb">locals</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;jupyter&quot;</span><span class="p">]</span>        <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;__IPYTHON__&quot;</span><span class="p">,</span> <span class="s2">&quot;get_ipython&quot;</span><span class="p">])</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;gitlab_ci&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;GITLAB_CI&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="k">else</span> <span class="n">MSG_NOT_FOUND</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;azure_devops&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;TF_BUILD&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="k">else</span> <span class="n">MSG_NOT_FOUND</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;github_actions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;GITHUB_ACTIONS&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="k">else</span> <span class="n">MSG_NOT_FOUND</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;simaticai&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSG_NOT_FOUND</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;vep-template-sdk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSG_NOT_FOUND</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;simaticai&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;simaticai&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>

        <span class="k">except</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">DistributionNotFound</span><span class="p">:</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;simaticai package not found&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;vep-template-sdk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;vep-template-sdk&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>

        <span class="k">except</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">DistributionNotFound</span><span class="p">:</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;vep-template-sdk package not found&quot;</span><span class="p">)</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">][</span><span class="s2">&quot;python_versions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">python_version</span> <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">],</span> <span class="n">PythonComponent</span><span class="p">)))</span>

        <span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">][</span><span class="s2">&quot;file_extensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;.html&quot;</span><span class="p">]))</span>

        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">telemetry_data</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">telemetry_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Validates whether the package configuration is compatible with the expected runtime environment.</span>

<span class="sd">        The method verifies:</span>

<span class="sd">        - If the package has at least one component</span>

<span class="sd">        - If all wires create connections between existing components and their variables</span>

<span class="sd">        - If metadata is defined and valid.</span>

<span class="sd">        - If a package with the same name already exists in the `destination` folder. In this case a warning message appears and the `save(..)` method overwrites the existing package.</span>

<span class="sd">        - If the package has multiple components and if they are using the same Python version</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (str, optional): Path of the expected destination folder. Defaults to &quot;.&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The package must have at least one component.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">outputBatch</span><span class="p">:</span>

                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The component &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has pipeline output defined with variable name &#39;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&#39;. </span><span class="se">\</span>

                                      <span class="kc">None</span> <span class="n">of</span> <span class="n">component</span> <span class="k">with</span> <span class="n">pipeline</span> <span class="n">output</span> <span class="ow">is</span> <span class="n">allowed</span> <span class="n">to</span> <span class="n">provide</span> <span class="n">batch</span> <span class="n">output</span><span class="o">.</span><span class="s2">&quot;)</span>

        <span class="k">for</span> <span class="n">wire_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>

            <span class="n">wire</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">[</span><span class="n">wire_hash</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_check_wiring</span><span class="p">(</span><span class="n">wire</span><span class="p">,</span> <span class="n">wire_hash</span><span class="p">)</span>

        <span class="n">pipeline_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

        <span class="n">pipeline_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">variable</span> <span class="ow">in</span> <span class="n">pipeline_outputs</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">pipeline_inputs</span><span class="p">):</span>

            <span class="n">conflicts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pipeline_inputs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pipeline_outputs</span><span class="p">))</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline input and output variables must be unique. Conflicting variables: </span><span class="si">{</span><span class="n">conflicts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_timeshifting</span><span class="p">()</span>

        <span class="n">package_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">package_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target folder (</span><span class="si">{</span><span class="n">package_path</span><span class="si">}</span><span class="s2">) already exists! Unless changing the package name the package could be invalid and your files will be overwritten!&quot;</span><span class="p">)</span>

        <span class="n">python_versions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">],</span> <span class="n">PythonComponent</span><span class="p">):</span>

                <span class="n">python_versions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">python_version</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">python_versions</span><span class="p">)):</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The use of multiple python version in a single pipeline is not recommended. We recommend using only one of the supported versions, which are Python 3.10 or 3.11.&quot;</span><span class="p">)</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is valid and ready to save.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_timeshifting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;When using inter signal alignment reference variables, the periodicity must be set.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_wiring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wire</span><span class="p">,</span> <span class="n">wire_hash</span><span class="p">):</span>

        <span class="n">error_messages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From component </span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;To component </span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

            <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output variable </span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> does not exist on component </span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

            <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input variable </span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> does not exist on component </span><span class="si">{</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_messages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">from_type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

            <span class="n">to_type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">from_type_</span> <span class="o">!=</span> <span class="n">to_type_</span><span class="p">:</span>

                <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The types of input and output variables does not match for wiring </span><span class="si">{</span><span class="n">wire_hash</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wire_hash</span><span class="p">)</span>

            <span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;The wire has been deleted, please check the variables and re-create the connection.&quot;</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">package_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        @Deprecated, reason: only edge package generation will be supported in the future. Use export instead.</span>

<span class="sd">        Saves the assembled package in a zip format.</span>

<span class="sd">        The name of the file is defined as `{package_name}_{package_version}.zip`.</span>

<span class="sd">        If a file with such a name already exists in the `destination` folder, it gets overwritten and a warning message appears.</span>

<span class="sd">        The package is also available as a subfolder on the destination path with the name `{package_name}_{package_version}`.</span>

<span class="sd">        If the assembled content does not meet the expected one, this content can be changed and simply packed into a zip file.</span>

<span class="sd">        The package contains files and folders in the following structure:</span>

<span class="sd">        - Package folder with name `{package_name}_{package_version}`</span>

<span class="sd">            - `datalink-metadata.yml`</span>

<span class="sd">            - `pipeline-config.yml`</span>

<span class="sd">            - Component folder with name `{component_name}`</span>

<span class="sd">            When the component is a `PythonComponent`, this folder contains:</span>

<span class="sd">            - `requirements.txt`</span>

<span class="sd">            - Entrypoint script defined by the entrypoint of the component</span>

<span class="sd">            - Extra files as added to the specified folders</span>

<span class="sd">            - Source folder with name `src` with necessary python scripts</span>

<span class="sd">        If a package ID is specified, and a package with the same ID and version is already present in the `destination` folder,</span>

<span class="sd">        an error is raised.</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (str, optional): Target directory for saving the package. Defaults to &quot;.&quot;.</span>

<span class="sd">            package_id (UUID): The optional package ID. If None, a new UUID is generated.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_save_version_and_package_id</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">),</span> <span class="n">package_id</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="n">destination</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="n">package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span> <span class="o">/</span> <span class="n">package_name</span>

        <span class="n">destination</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">],</span> <span class="n">PythonComponent</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="o">.</span><span class="n">add_direct_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">python_dependencies</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_datalink_metadata</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_config</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="n">p_page</span><span class="o">.</span><span class="n">save_readme_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_telemetry_data</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="n">zip_destination</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>

            <span class="n">base_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">package_name</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

            <span class="n">root_dir</span><span class="o">=</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>

            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">)</span>

        <span class="n">pipeline_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">zip_destination</span><span class="p">)</span>  <span class="c1"># zipped package size in bytes</span>

        <span class="n">pipeline_size_GB</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipeline_size</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="n">pipeline_size_limit_GB</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PIPELINE_SIZE_LIMIT</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pipeline_size</span> <span class="o">&gt;</span> <span class="n">PIPELINE_SIZE_LIMIT</span><span class="p">:</span>

            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pipeline size </span><span class="si">{</span><span class="n">pipeline_size</span><span class="si">}</span><span class="s2"> bytes (</span><span class="si">{</span><span class="n">pipeline_size_GB</span><span class="si">}</span><span class="s2"> GB) exceeds the limit of &quot;</span> \

                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PIPELINE_SIZE_LIMIT</span><span class="si">}</span><span class="s2"> bytes (</span><span class="si">{</span><span class="n">pipeline_size_limit_GB</span><span class="si">}</span><span class="s2"> GB). &quot;</span> \

                        <span class="s2">&quot;Please remove unnecessary files and dependencies and try again.&quot;</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">zip_destination</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_save_version_and_package_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">package_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">],</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>

        <span class="n">previous_versions_and_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_versions_and_package_ids_of_existing_packages</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="n">previous_versions</span><span class="p">,</span> <span class="n">previous_package_ids</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">previous_versions_and_ids</span><span class="p">)</span> <span class="k">if</span> <span class="n">previous_versions_and_ids</span> <span class="k">else</span> <span class="p">([],</span> <span class="p">[])</span>

        <span class="c1"># if package id is provided, we use that</span>

        <span class="k">if</span> <span class="n">package_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">package_id</span> <span class="o">=</span> <span class="n">package_id</span>

        <span class="c1"># auto-generate package id if not provided</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">previous_package_ids_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">pkg_id</span> <span class="k">for</span> <span class="n">pkg_id</span> <span class="ow">in</span> <span class="n">previous_package_ids</span> <span class="k">if</span> <span class="n">pkg_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">previous_package_ids_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">previous_package_ids_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">package_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">previous_package_ids_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">package_id</span> <span class="o">=</span> <span class="n">previous_package_ids_set</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple package IDs found in the destination folder: </span><span class="si">{</span><span class="n">previous_package_ids_set</span><span class="si">}</span><span class="s2">. Set a package ID.&quot;</span><span class="p">)</span>

                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple package IDs found in the destination folder: </span><span class="si">{</span><span class="n">previous_package_ids_set</span><span class="si">}</span><span class="s2">. Set a package ID.&quot;</span><span class="p">)</span>

        <span class="c1"># Preference #1: use the provided version</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="o">=</span> <span class="n">version</span>

        <span class="c1"># Preference #2: use the version set at init time</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

        <span class="c1"># Preference #3: auto-generate version</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">previous_decimal_versions_set</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">previous_versions</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">()}</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">previous_decimal_versions_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">save_version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">previous_decimal_versions_set</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># check if the package zip already exists</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="n">package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">package_file</span> <span class="o">=</span> <span class="n">destination</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">.zip&quot;</span>

        <span class="k">if</span> <span class="n">package_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target package with version &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="si">}</span><span class="s2">&#39; already exists: &#39;</span><span class="si">{</span><span class="n">package_file</span><span class="si">}</span><span class="s2">. The package will be overwritten.&quot;</span><span class="p">)</span>

        <span class="n">edge_package_file</span> <span class="o">=</span> <span class="n">destination</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-edge_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="si">}</span><span class="s2">.zip&quot;</span>

        <span class="k">if</span> <span class="n">edge_package_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target package with version &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="si">}</span><span class="s2">&#39; already exists: &#39;</span><span class="si">{</span><span class="n">edge_package_file</span><span class="si">}</span><span class="s2">. The package will be overwritten.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_versions_and_package_ids_of_existing_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]]]:</span>

        <span class="n">package_versions_and_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">destination</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">*.zip&quot;</span><span class="p">):</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>

                <span class="n">config_path</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;pipeline_config.yml&quot;</span><span class="p">))</span>

                <span class="k">with</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>

                    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeLoader</span><span class="p">)</span>

                    <span class="n">pipeline_info</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataFlowPipelineInfo&quot;</span><span class="p">,</span> <span class="p">{})</span>

                    <span class="n">name</span> <span class="o">=</span> <span class="n">pipeline_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>

                        <span class="k">continue</span>

                    <span class="n">version</span> <span class="o">=</span> <span class="n">pipeline_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataFlowPipelineVersion&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="n">package_id</span> <span class="o">=</span> <span class="n">pipeline_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;packageId&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="n">package_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">package_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

                    <span class="n">package_versions_and_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">version</span><span class="p">,</span> <span class="n">package_id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">package_versions_and_ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">package_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Export a runnable pipeline package.</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (str): optional target directory for saving the package. Defaults to &quot;.&quot;.</span>

<span class="sd">            package_id (UUID): optional package ID. If None, a new UUID is generated.</span>

<span class="sd">            version (str): optional version. If None, an automatic version number is generated.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_package</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">config_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">package_id</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

            <span class="n">runtime_package</span> <span class="o">=</span> <span class="n">convert_package</span><span class="p">(</span><span class="n">config_package</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">runtime_package</span>

        <span class="k">finally</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">config_package</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">Path</span><span class="p">(</span><span class="n">config_package</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">topic_based</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Adds a parameter to the pipeline configuration, which alters the behavior of the pipeline.</span>

<span class="sd">        The parameter&#39;s default value and its properties are saved in the pipeline configuration</span>

<span class="sd">        and the value of the parameter can later be changed on AI Inference Server.</span>

<span class="sd">        Args:</span>

<span class="sd">            name (str): Name of the parameter</span>

<span class="sd">            desc (str): Description of the parameter (optional)</span>

<span class="sd">            type_name (str, optional): Data type of the parameter. Defaults to &quot;String&quot;.</span>

<span class="sd">            default_value (str): Default value of the parameter</span>

<span class="sd">            topic_based (bool, optional): If true, the parameter can be updated from a message queue.</span>

<span class="sd">        Raises:</span>

<span class="sd">            ValueError:</span>

<span class="sd">                When:</span>

<span class="sd">                - the default value of the parameter is not of the specified data type (`type_name`) or</span>

<span class="sd">                - the specified data type itself is not an allowed data type (not a part of `parameter_types` dict) or</span>

<span class="sd">                - the specified data type is not given in the right format or</span>

<span class="sd">                - the type of the given `topic_based` parameter is not `bool`.</span>

<span class="sd">                - the name of the parameter starts with `__AI_IS_` prefix. These are reserved parameters by AI Inference Server</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">parameter_types</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s2">&quot;String&quot;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span>

            <span class="s2">&quot;Integer&quot;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span>

            <span class="s2">&quot;Double&quot;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span>

            <span class="s2">&quot;Boolean&quot;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span>

        <span class="p">}</span>

        <span class="n">default_value_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__AI_IS_&quot;</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Pipeline parameters with `__AI_IS_` prefix should not be specified in the pipeline configuration. However, the entrypoint script should be able to handle them in the `update_parameters` method.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">type_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameter_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The given value type is not supported. Please use one of these: </span><span class="si">{</span><span class="n">parameter_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">default_value_type</span> <span class="o">!=</span> <span class="n">parameter_types</span><span class="p">[</span><span class="n">type_name</span><span class="p">]:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The given value type does not match the type of &#39;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&#39;. Please use the correct one from these: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">parameter_types</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic_based</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Type of the given `topic_based` parameter is not `bool`.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>

            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">type_name</span><span class="p">,</span>

            <span class="s2">&quot;defaultValue&quot;</span><span class="p">:</span> <span class="n">default_value</span><span class="p">,</span>

            <span class="s2">&quot;topicBased&quot;</span><span class="p">:</span> <span class="n">topic_based</span><span class="p">,</span>

            <span class="s2">&quot;valueTopic&quot;</span><span class="p">:</span> <span class="kc">None</span>

        <span class="p">}</span>

        <span class="k">if</span> <span class="n">desc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;desc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_package</span><span class="p">(</span><span class="n">zip_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">report_writer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PipelineReportWriter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    @Deprecated, reason: only edge package generation will be supported in the future. Use Pipeline.export(...) instead.</span>

<span class="sd">    Create an Edge Configuration Package from a given Pipeline Configuration Package.</span>

<span class="sd">    If the input zip file is `{path}/{name}_{version}.zip`, the output file will be created as `{path}/{name}-edge_{version}.zip`.</span>

<span class="sd">    Please make sure that the given zip file comes from a trusted source!</span>

<span class="sd">    If a file with such a name already exists, it is overwritten.</span>

<span class="sd">    First, this method verifies that the requirements identified by name and version are either included</span>

<span class="sd">    in `PythonPackages.zip` or available on pypi.org for the target platform.</span>

<span class="sd">    Currently, the supported edge devices run Linux on 64-bit x86 architecture, so the accepted Python libraries are restricted to the platform independent ones and packages built for &#39;x86_64&#39; platforms.</span>

<span class="sd">    AI Inference Server also provides a Python 3.10 and runtime environment, so the supported Python libraries are restricted to Python 3.10 and 3.11 compatible packages.</span>

<span class="sd">    If for the target platform the required dependency is not available on pypi.org</span>

<span class="sd">    and not present in `PythonPackages.zip`,  it will log the problem at ERROR level.</span>

<span class="sd">    Then it downloads all dependencies (either direct or transitive), and creates a new zip</span>

<span class="sd">    file, which is validated against the AI Inference Server&#39;s schema.</span>

<span class="sd">    This functionality requires pip with version of 21.3.1 or greater.</span>

<span class="sd">    This method can be used from the command line too.</span>

<span class="sd">    Example usage:</span>

<span class="sd">    ```</span>

<span class="sd">    python -m simaticai convert_package &lt;path_to_pipeline_configuration_package.zip&gt;</span>

<span class="sd">    ```</span>

<span class="sd">    Args:</span>

<span class="sd">        zip_path (path-like): path to the pipeline configuration package zip file.</span>

<span class="sd">        report_writer (ReportWriter, optional): a ReportWriter object to write the report for a pipeline. Defaults to None.</span>

<span class="sd">    Returns:</span>

<span class="sd">        os.PathLike: The path of the created zip file.</span>

<span class="sd">    Exceptions:</span>

<span class="sd">        PipelineValidationError: If the validation fails. See the logger output for details.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">zip_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The input zip file name must contain an underscore character.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tempfiles</span><span class="o">.</span><span class="n">OpenZipInTemp</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_dir</span><span class="p">:</span>

        <span class="n">top_level_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">zip_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_level_items</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;The Pipeline Configuration Package must contain a single top level directory.&quot;</span><span class="p">)</span>

        <span class="n">package_dir</span> <span class="o">=</span> <span class="n">zip_dir</span> <span class="o">/</span> <span class="n">top_level_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">runtime_dir</span> <span class="o">=</span> <span class="n">zip_dir</span> <span class="o">/</span> <span class="s2">&quot;edge_config_package&quot;</span>

        <span class="n">runtime_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml_helper</span><span class="o">.</span><span class="n">read_yaml</span><span class="p">(</span><span class="n">package_dir</span> <span class="o">/</span> <span class="n">PIPELINE_CONFIG</span><span class="p">)</span>

        <span class="n">_validate_with_schema</span><span class="p">(</span><span class="s2">&quot;input pipeline_config.yml&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="s2">&quot;pipeline.schema.json&quot;</span><span class="p">)</span>

        <span class="n">runtime_config</span> <span class="o">=</span> <span class="n">_generate_runtime_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># TODO: consider moving zip_path to the parameter of report_writer.write_report()</span>

            <span class="n">report_writer</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">zip_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_package_report.md&quot;</span><span class="p">))</span>

            <span class="n">report_writer</span><span class="o">.</span><span class="n">set_pipeline_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dataFlowPipeline&#39;</span><span class="p">][</span><span class="s1">&#39;components&#39;</span><span class="p">]:</span>

            <span class="n">source_dir</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;python&quot;</span><span class="p">:</span>

                <span class="n">python_version</span> <span class="o">=</span> <span class="n">component</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="n">python_version_validator</span><span class="p">(</span><span class="n">python_version</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>

                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

                <span class="n">dependency_set</span> <span class="o">=</span> <span class="n">_package_component_dependencies</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">python_version</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="n">report_writer</span><span class="o">.</span><span class="n">add_full_dependency_set</span><span class="p">(</span><span class="n">component_name</span><span class="o">=</span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">dependency_set</span><span class="o">=</span><span class="n">dependency_set</span><span class="p">)</span>

                <span class="n">runtime_config</span><span class="p">[</span><span class="s2">&quot;runtimeConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;components&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>

                    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;IED1&quot;</span><span class="p">,</span>

                    <span class="s2">&quot;targetRuntime&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">,</span>

                <span class="p">})</span>

            <span class="k">if</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gpuruntime&quot;</span><span class="p">:</span>

                <span class="n">runtime_config</span><span class="p">[</span><span class="s2">&quot;runtimeConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;components&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>

                    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;IED1&quot;</span><span class="p">,</span>

                    <span class="s2">&quot;targetRuntime&quot;</span><span class="p">:</span> <span class="s2">&quot;gpuruntime&quot;</span><span class="p">,</span>

                <span class="p">})</span>

            <span class="n">_package_component</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">runtime_dir</span> <span class="o">/</span> <span class="s1">&#39;components&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">report_writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">report_writer</span><span class="o">.</span><span class="n">write_report</span><span class="p">()</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report on </span><span class="si">{</span><span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2"> is saved to </span><span class="si">{</span><span class="n">zip_path</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">package_dir</span> <span class="o">/</span> <span class="n">PIPELINE_CONFIG</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">runtime_dir</span> <span class="o">/</span> <span class="n">PIPELINE_CONFIG</span><span class="p">))</span>

        <span class="n">datalink_metadata_yaml</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="n">DATALINK_METADATA</span>

        <span class="k">if</span> <span class="n">datalink_metadata_yaml</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>

            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datalink_metadata_yaml</span><span class="p">),</span> <span class="n">runtime_dir</span> <span class="o">/</span> <span class="n">DATALINK_METADATA</span><span class="p">)</span>

        <span class="n">_validate_with_schema</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;generated </span><span class="si">{</span><span class="n">RUNTIME_CONFIG</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">runtime_config</span><span class="p">,</span> <span class="s2">&quot;runtime.schema.json&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">runtime_dir</span> <span class="o">/</span> <span class="n">RUNTIME_CONFIG</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>

            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">runtime_config</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="n">readme_html</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="n">README_HTML</span>

        <span class="k">if</span> <span class="n">readme_html</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

            <span class="p">(</span><span class="n">runtime_dir</span> <span class="o">/</span> <span class="n">README_HTML</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">readme_html</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

        <span class="n">telemetry_yaml</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="n">TELEMETRY_YAML</span>

        <span class="k">if</span> <span class="n">telemetry_yaml</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

            <span class="p">(</span><span class="n">runtime_dir</span> <span class="o">/</span> <span class="n">TELEMETRY_YAML</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">telemetry_yaml</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

        <span class="n">edge_package_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>

            <span class="c1"># One Pythonic Way to replace the last occurrence of &quot;_&quot; with &quot;-edge&quot;.</span>

            <span class="n">base_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">PurePath</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;-edge_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))),</span>

            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

            <span class="n">root_dir</span><span class="o">=</span><span class="n">runtime_dir</span><span class="p">,</span>

            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

            <span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">))</span>

        <span class="n">sha256_hash</span> <span class="o">=</span> <span class="n">calc_sha</span><span class="p">(</span><span class="n">edge_package_path</span><span class="p">)</span>

        <span class="n">sha_format</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sha256_hash</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">edge_package_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">edge_package_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.sha256&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">sha_format</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">edge_package_path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_validate_with_schema</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">schema_path</span> <span class="o">=</span> <span class="n">module_resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;simaticai&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;schemas&quot;</span> <span class="o">/</span> <span class="n">schema_name</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_file</span><span class="p">:</span>

            <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_file</span><span class="p">)</span>

            <span class="n">jsonschema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span> <span class="n">instance</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">jsonschema</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="c1"># f&quot;&quot;&quot;$id: {e.schema[&#39;$id&#39;]}</span>

        <span class="c1"># title: {e.schema[&#39;title&#39;]}</span>

        <span class="c1"># description: {e.schema[&#39;description&#39;]}&quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Schema validation failed for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> using &#39;</span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">&#39;!</span>

<span class="s2">        message: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_package_component</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">target_name</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>

        <span class="n">base_name</span><span class="o">=</span><span class="n">target_name</span><span class="p">,</span>

        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

        <span class="n">root_dir</span><span class="o">=</span><span class="n">source_dir</span><span class="p">,</span>

        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

        <span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_package_component_dependencies</span><span class="p">(</span><span class="n">component_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">python_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>

    <span class="n">python_packages_folder</span> <span class="o">=</span> <span class="n">component_dir</span> <span class="o">/</span> <span class="s1">&#39;packages&#39;</span>

    <span class="n">requirements_file_path</span> <span class="o">=</span> <span class="n">component_dir</span> <span class="o">/</span> <span class="n">REQUIREMENTS_TXT</span>

    <span class="n">packages_file</span> <span class="o">=</span> <span class="n">component_dir</span> <span class="o">/</span> <span class="n">PYTHON_PACKAGES_ZIP</span>

    <span class="n">dependency_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">python_packages_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">packages_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>

        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">packages_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>

            <span class="n">zip_file</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">python_packages_folder</span><span class="p">)</span>

        <span class="n">packages_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="n">requirements_file_path</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">dependency_set</span> <span class="o">=</span> <span class="n">create_wheelhouse</span><span class="p">(</span><span class="n">requirements_file_path</span><span class="p">,</span> <span class="n">python_version</span><span class="p">,</span> <span class="n">python_packages_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">python_packages_folder</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>

            <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>

                <span class="n">base_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">component_dir</span> <span class="o">/</span> <span class="n">PYTHON_PACKAGES</span><span class="p">),</span>

                <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

                <span class="n">root_dir</span><span class="o">=</span><span class="n">python_packages_folder</span><span class="p">,</span>

                <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

                <span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">)</span>

    <span class="k">finally</span><span class="p">:</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">python_packages_folder</span><span class="p">)</span>

    <span class="c1"># This filtering needs to happen here, not in PythonDependencies,</span>

    <span class="c1"># because create_wheelhouse still needs the original requirements.txt</span>

    <span class="c1"># with the extra index urls.</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requirements_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">filtered_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;# Extra&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--extra-index-url&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;# Index&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--index-url&quot;</span><span class="p">)),</span> <span class="n">lines</span><span class="p">))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requirements_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">filtered_lines</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dependency_set</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_generate_runtime_config</span><span class="p">(</span><span class="n">pipeline_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

    <span class="n">project_name</span> <span class="o">=</span> <span class="n">pipeline_config</span><span class="p">[</span><span class="s2">&quot;dataFlowPipelineInfo&quot;</span><span class="p">][</span><span class="s2">&quot;projectName&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>

        <span class="s2">&quot;fileFormatVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>

        <span class="s2">&quot;runtimeInfo&quot;</span><span class="p">:</span> <span class="p">{</span>

            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">,</span>

            <span class="s2">&quot;runtimeConfigurationVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>

            <span class="s2">&quot;createdOn&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">),</span>

        <span class="p">},</span>

        <span class="s2">&quot;runtimeConfiguration&quot;</span><span class="p">:</span> <span class="p">{</span>

            <span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="p">[{</span>

                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IED1&quot;</span><span class="p">,</span>

                <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>  <span class="c1"># Optional</span>

                <span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>  <span class="c1"># Optional, TODO: validate target keys</span>

            <span class="p">}],</span>

            <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">[],</span>

        <span class="p">},</span>

    <span class="p">}</span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="_generate_runtime_config">_generate_runtime_config</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_generate_runtime_config</span><span class="p">(</span>
    <span class="n">pipeline_config</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="nx">def</span><span class="w"> </span><span class="nx">_generate_runtime_config</span><span class="p">(</span><span class="nx">pipeline_config</span><span class="p">:</span><span class="w"> </span><span class="nx">dict</span><span class="p">):</span>

<span class="w">    </span><span class="nx">project_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pipeline_config</span><span class="p">[</span><span class="s">&quot;dataFlowPipelineInfo&quot;</span><span class="p">][</span><span class="s">&quot;projectName&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="s">&quot;fileFormatVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="s">&quot;runtimeInfo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s">&quot;projectName&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">project_name</span><span class="p">,</span>

<span class="w">            </span><span class="s">&quot;runtimeConfigurationVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="s">&quot;createdOn&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">datetime</span><span class="p">.</span><span class="nx">utcnow</span><span class="p">().</span><span class="nx">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-%dT%H:%M:%SZ&quot;</span><span class="p">),</span>

<span class="w">        </span><span class="p">},</span>

<span class="w">        </span><span class="s">&quot;runtimeConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>

<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IED1&quot;</span><span class="p">,</span>

<span class="w">                </span><span class="s">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Optional</span>

<span class="w">                </span><span class="s">&quot;arch&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;x86_64&quot;</span><span class="p">,</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Optional</span><span class="p">,</span><span class="w"> </span><span class="nx">TODO</span><span class="p">:</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="nx">keys</span>

<span class="w">            </span><span class="p">}],</span>

<span class="w">            </span><span class="s">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>

<span class="w">        </span><span class="p">},</span>

<span class="w">    </span><span class="p">}</span>
</code></pre></div>

</details>
<h3 id="_package_component">_package_component</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_package_component</span><span class="p">(</span>
    <span class="n">source_dir</span><span class="p">,</span>
    <span class="n">target_name</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="nx">def</span><span class="w"> </span><span class="nx">_package_component</span><span class="p">(</span><span class="nx">source_dir</span><span class="p">,</span><span class="w"> </span><span class="nx">target_name</span><span class="p">):</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">shutil</span><span class="p">.</span><span class="nx">make_archive</span><span class="p">(</span>

<span class="w">        </span><span class="nx">base_name</span><span class="p">=</span><span class="nx">target_name</span><span class="p">,</span>

<span class="w">        </span><span class="nx">format</span><span class="p">=</span><span class="err">&#39;</span><span class="nx">zip</span><span class="err">&#39;</span><span class="p">,</span>

<span class="w">        </span><span class="nx">root_dir</span><span class="p">=</span><span class="nx">source_dir</span><span class="p">,</span>

<span class="w">        </span><span class="nx">verbose</span><span class="p">=</span><span class="nx">True</span><span class="p">,</span>

<span class="w">        </span><span class="nx">logger</span><span class="p">=</span><span class="nx">_logger</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="_package_component_dependencies">_package_component_dependencies</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_package_component_dependencies</span><span class="p">(</span>
    <span class="n">component_dir</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">python_version</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="nx">def</span><span class="w"> </span><span class="nx">_package_component_dependencies</span><span class="p">(</span><span class="nx">component_dir</span><span class="p">:</span><span class="w"> </span><span class="nx">Path</span><span class="p">,</span><span class="w"> </span><span class="nx">python_version</span><span class="p">:</span><span class="w"> </span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">:</span>

<span class="w">    </span><span class="nx">python_packages_folder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">component_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">packages</span><span class="err">&#39;</span>

<span class="w">    </span><span class="nx">requirements_file_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">component_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">REQUIREMENTS_TXT</span>

<span class="w">    </span><span class="nx">packages_file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">component_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">PYTHON_PACKAGES_ZIP</span>

<span class="w">    </span><span class="nx">dependency_set</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">set</span><span class="p">()</span>

<span class="w">    </span><span class="nx">python_packages_folder</span><span class="p">.</span><span class="nx">mkdir</span><span class="p">(</span><span class="nx">exist_ok</span><span class="p">=</span><span class="nx">True</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">packages_file</span><span class="p">.</span><span class="nx">is_file</span><span class="p">():</span>

<span class="w">        </span><span class="nx">with</span><span class="w"> </span><span class="nx">zipfile</span><span class="p">.</span><span class="nx">ZipFile</span><span class="p">(</span><span class="nx">packages_file</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">zip_file</span><span class="p">:</span>

<span class="w">            </span><span class="nx">zip_file</span><span class="p">.</span><span class="nx">extractall</span><span class="p">(</span><span class="nx">python_packages_folder</span><span class="p">)</span>

<span class="w">        </span><span class="nx">packages_file</span><span class="p">.</span><span class="nx">unlink</span><span class="p">()</span>

<span class="w">    </span><span class="nx">requirements_file_path</span><span class="p">.</span><span class="nx">touch</span><span class="p">(</span><span class="nx">exist_ok</span><span class="p">=</span><span class="nx">True</span><span class="p">)</span>

<span class="w">    </span><span class="nx">try</span><span class="p">:</span>

<span class="w">        </span><span class="nx">dependency_set</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">create_wheelhouse</span><span class="p">(</span><span class="nx">requirements_file_path</span><span class="p">,</span><span class="w"> </span><span class="nx">python_version</span><span class="p">,</span><span class="w"> </span><span class="nx">python_packages_folder</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">any</span><span class="p">(</span><span class="nx">Path</span><span class="p">(</span><span class="nx">python_packages_folder</span><span class="p">).</span><span class="nx">iterdir</span><span class="p">()):</span>

<span class="w">            </span><span class="nx">shutil</span><span class="p">.</span><span class="nx">make_archive</span><span class="p">(</span>

<span class="w">                </span><span class="nx">base_name</span><span class="p">=</span><span class="nx">str</span><span class="p">(</span><span class="nx">component_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">PYTHON_PACKAGES</span><span class="p">),</span>

<span class="w">                </span><span class="nx">format</span><span class="p">=</span><span class="err">&#39;</span><span class="nx">zip</span><span class="err">&#39;</span><span class="p">,</span>

<span class="w">                </span><span class="nx">root_dir</span><span class="p">=</span><span class="nx">python_packages_folder</span><span class="p">,</span>

<span class="w">                </span><span class="nx">verbose</span><span class="p">=</span><span class="nx">True</span><span class="p">,</span>

<span class="w">                </span><span class="nx">logger</span><span class="p">=</span><span class="nx">_logger</span><span class="p">)</span>

<span class="w">    </span><span class="nx">finally</span><span class="p">:</span>

<span class="w">        </span><span class="nx">shutil</span><span class="p">.</span><span class="nx">rmtree</span><span class="p">(</span><span class="nx">python_packages_folder</span><span class="p">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">filtering</span><span class="w"> </span><span class="nx">needs</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">happen</span><span class="w"> </span><span class="nx">here</span><span class="p">,</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">PythonDependencies</span><span class="p">,</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">because</span><span class="w"> </span><span class="nx">create_wheelhouse</span><span class="w"> </span><span class="nx">still</span><span class="w"> </span><span class="nx">needs</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="nx">requirements</span><span class="p">.</span><span class="nx">txt</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">extra</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="nx">urls</span><span class="p">.</span>

<span class="w">    </span><span class="nx">with</span><span class="w"> </span><span class="nx">open</span><span class="p">(</span><span class="nx">requirements_file_path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">f</span><span class="p">:</span>

<span class="w">        </span><span class="nx">lines</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">readlines</span><span class="p">()</span>

<span class="w">    </span><span class="nx">filtered_lines</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">list</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nx">lambda</span><span class="w"> </span><span class="nx">x</span><span class="p">:</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">startswith</span><span class="p">(</span><span class="s">&quot;# Extra&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">startswith</span><span class="p">(</span><span class="s">&quot;--extra-index-url&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">startswith</span><span class="p">(</span><span class="s">&quot;# Index&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">startswith</span><span class="p">(</span><span class="s">&quot;--index-url&quot;</span><span class="p">)),</span><span class="w"> </span><span class="nx">lines</span><span class="p">))</span>

<span class="w">    </span><span class="nx">with</span><span class="w"> </span><span class="nx">open</span><span class="p">(</span><span class="nx">requirements_file_path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">f</span><span class="p">:</span>

<span class="w">        </span><span class="nx">f</span><span class="p">.</span><span class="nx">writelines</span><span class="p">(</span><span class="nx">filtered_lines</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">dependency_set</span>
</code></pre></div>

</details>
<h3 id="_validate_with_schema">_validate_with_schema</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_validate_with_schema</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">_validate_with_schema</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="n">dict</span><span class="p">,</span><span class="w"> </span><span class="n">schema_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">    </span><span class="n">try</span><span class="p">:</span>

<span class="w">        </span><span class="n">schema_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;simaticai&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">&quot;schemas&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">schema_name</span>

<span class="w">        </span><span class="n">with</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">schema_path</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">schema_file</span><span class="p">:</span>

<span class="w">            </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_file</span><span class="p">)</span>

<span class="w">            </span><span class="n">jsonschema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="w"> </span><span class="n">instance</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>

<span class="w">    </span><span class="n">except</span><span class="w"> </span><span class="n">jsonschema</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">e</span><span class="p">:</span>

<span class="w">        </span><span class="c1"># f&quot;&quot;&quot;$id: {e.schema[&#39;$id&#39;]}</span>

<span class="w">        </span><span class="c1"># title: {e.schema[&#39;title&#39;]}</span>

<span class="w">        </span><span class="c1"># description: {e.schema[&#39;description&#39;]}&quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;Schema validation failed for {name} using &#39;{schema}&#39;!</span>

<span class="s2">        message: {e.message}</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">None</span>
</code></pre></div>

</details>
<h3 id="convert_package">convert_package</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_package</span><span class="p">(</span>
    <span class="n">zip_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
    <span class="n">report_writer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">simaticai</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">PipelineReportWriter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
</code></pre></div>

<p>@Deprecated, reason: only edge package generation will be supported in the future. Use Pipeline.export(...) instead.</p>
<p>Create an Edge Configuration Package from a given Pipeline Configuration Package.</p>
<p>If the input zip file is <code>{path}/{name}_{version}.zip</code>, the output file will be created as <code>{path}/{name}-edge_{version}.zip</code>.
Please make sure that the given zip file comes from a trusted source!</p>
<p>If a file with such a name already exists, it is overwritten.</p>
<p>First, this method verifies that the requirements identified by name and version are either included
in <code>PythonPackages.zip</code> or available on pypi.org for the target platform.</p>
<p>Currently, the supported edge devices run Linux on 64-bit x86 architecture, so the accepted Python libraries are restricted to the platform independent ones and packages built for 'x86_64' platforms.
AI Inference Server also provides a Python 3.10 and runtime environment, so the supported Python libraries are restricted to Python 3.10 and 3.11 compatible packages.</p>
<p>If for the target platform the required dependency is not available on pypi.org
and not present in <code>PythonPackages.zip</code>,  it will log the problem at ERROR level.
Then it downloads all dependencies (either direct or transitive), and creates a new zip
file, which is validated against the AI Inference Server's schema.
This functionality requires pip with version of 21.3.1 or greater.</p>
<p>This method can be used from the command line too.
Example usage:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">python</span><span class="w"> </span><span class="o">-</span><span class="nx">m</span><span class="w"> </span><span class="nx">simaticai</span><span class="w"> </span><span class="nx">convert_package</span><span class="w"> </span><span class="p">&lt;</span><span class="nx">path_to_pipeline_configuration_package</span><span class="p">.</span><span class="nx">zip</span><span class="p">&gt;</span>
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>zip_path</td>
<td>path-like</td>
<td>path to the pipeline configuration package zip file.</td>
<td>None</td>
</tr>
<tr>
<td>report_writer</td>
<td>ReportWriter</td>
<td>a ReportWriter object to write the report for a pipeline. Defaults to None.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>os.PathLike</td>
<td>The path of the created zip file.</td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>PipelineValidationError</td>
<td>If the validation fails. See the logger output for details.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">convert_package</span><span class="p">(</span><span class="n">zip_path</span><span class="p">:</span><span class="w"> </span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span><span class="w"> </span><span class="n">report_writer</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">PipelineReportWriter</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Path</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    @Deprecated, reason: only edge package generation will be supported in the future. Use Pipeline.export(...) instead.</span>

<span class="sd">    Create an Edge Configuration Package from a given Pipeline Configuration Package.</span>

<span class="sd">    If the input zip file is `{path}/{name}_{version}.zip`, the output file will be created as `{path}/{name}-edge_{version}.zip`.</span>

<span class="sd">    Please make sure that the given zip file comes from a trusted source!</span>

<span class="sd">    If a file with such a name already exists, it is overwritten.</span>

<span class="sd">    First, this method verifies that the requirements identified by name and version are either included</span>

<span class="sd">    in `PythonPackages.zip` or available on pypi.org for the target platform.</span>

<span class="sd">    Currently, the supported edge devices run Linux on 64-bit x86 architecture, so the accepted Python libraries are restricted to the platform independent ones and packages built for &#39;x86_64&#39; platforms.</span>

<span class="sd">    AI Inference Server also provides a Python 3.10 and runtime environment, so the supported Python libraries are restricted to Python 3.10 and 3.11 compatible packages.</span>

<span class="sd">    If for the target platform the required dependency is not available on pypi.org</span>

<span class="sd">    and not present in `PythonPackages.zip`,  it will log the problem at ERROR level.</span>

<span class="sd">    Then it downloads all dependencies (either direct or transitive), and creates a new zip</span>

<span class="sd">    file, which is validated against the AI Inference Server&#39;s schema.</span>

<span class="sd">    This functionality requires pip with version of 21.3.1 or greater.</span>

<span class="sd">    This method can be used from the command line too.</span>

<span class="sd">    Example usage:</span>

<span class="sd">    ```</span>

<span class="sd">    python -m simaticai convert_package &lt;path_to_pipeline_configuration_package.zip&gt;</span>

<span class="sd">    ```</span>

<span class="sd">    Args:</span>

<span class="sd">        zip_path (path-like): path to the pipeline configuration package zip file.</span>

<span class="sd">        report_writer (ReportWriter, optional): a ReportWriter object to write the report for a pipeline. Defaults to None.</span>

<span class="sd">    Returns:</span>

<span class="sd">        os.PathLike: The path of the created zip file.</span>

<span class="sd">    Exceptions:</span>

<span class="sd">        PipelineValidationError: If the validation fails. See the logger output for details.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">zip_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The input zip file name must contain an underscore character.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">with</span><span class="w"> </span><span class="n">tempfiles</span><span class="o">.</span><span class="n">OpenZipInTemp</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">zip_dir</span><span class="p">:</span>

<span class="w">        </span><span class="n">top_level_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">zip_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">top_level_items</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The Pipeline Configuration Package must contain a single top level directory.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">package_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zip_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">top_level_items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="w">        </span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zip_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">&quot;edge_config_package&quot;</span>

<span class="w">        </span><span class="n">runtime_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="n">True</span><span class="p">,</span><span class="w"> </span><span class="n">exist_ok</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

<span class="w">        </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yaml_helper</span><span class="o">.</span><span class="n">read_yaml</span><span class="p">(</span><span class="n">package_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PIPELINE_CONFIG</span><span class="p">)</span>

<span class="w">        </span><span class="n">_validate_with_schema</span><span class="p">(</span><span class="s2">&quot;input pipeline_config.yml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pipeline.schema.json&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">runtime_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_generate_runtime_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">report_writer</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="c1"># TODO: consider moving zip_path to the parameter of report_writer.write_report()</span>

<span class="w">            </span><span class="n">report_writer</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">zip_path</span><span class="o">.</span><span class="n">parent</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{zip_path.stem}_package_report.md&quot;</span><span class="p">))</span>

<span class="w">            </span><span class="n">report_writer</span><span class="o">.</span><span class="n">set_pipeline_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;dataFlowPipeline&#39;</span><span class="p">][</span><span class="s1">&#39;components&#39;</span><span class="p">]:</span>

<span class="w">            </span><span class="n">source_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">package_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">:</span>

<span class="w">                </span><span class="n">python_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">]</span>

<span class="w">                </span><span class="n">try</span><span class="p">:</span>

<span class="w">                    </span><span class="n">python_version_validator</span><span class="p">(</span><span class="n">python_version</span><span class="p">)</span>

<span class="w">                </span><span class="n">except</span><span class="w"> </span><span class="n">ValueError</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">error</span><span class="p">:</span>

<span class="w">                    </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

<span class="w">                </span><span class="n">dependency_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_package_component_dependencies</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span><span class="w"> </span><span class="n">python_version</span><span class="p">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">report_writer</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">                    </span><span class="n">report_writer</span><span class="o">.</span><span class="n">add_full_dependency_set</span><span class="p">(</span><span class="n">component_name</span><span class="o">=</span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">dependency_set</span><span class="o">=</span><span class="n">dependency_set</span><span class="p">)</span>

<span class="w">                </span><span class="n">runtime_config</span><span class="p">[</span><span class="s2">&quot;runtimeConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;components&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

<span class="w">                    </span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>

<span class="w">                    </span><span class="s2">&quot;device&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IED1&quot;</span><span class="p">,</span>

<span class="w">                    </span><span class="s2">&quot;targetRuntime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Python&quot;</span><span class="p">,</span>

<span class="w">                </span><span class="p">})</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;runtime&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gpuruntime&quot;</span><span class="p">:</span>

<span class="w">                </span><span class="n">runtime_config</span><span class="p">[</span><span class="s2">&quot;runtimeConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;components&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

<span class="w">                    </span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>

<span class="w">                    </span><span class="s2">&quot;device&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IED1&quot;</span><span class="p">,</span>

<span class="w">                    </span><span class="s2">&quot;targetRuntime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpuruntime&quot;</span><span class="p">,</span>

<span class="w">                </span><span class="p">})</span>

<span class="w">            </span><span class="n">_package_component</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span><span class="w"> </span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">&#39;components&#39;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{component[&#39;name&#39;]}_{component[&#39;version&#39;]}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">report_writer</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">report_writer</span><span class="o">.</span><span class="n">write_report</span><span class="p">()</span>

<span class="w">        </span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Report on {zip_path.stem} is saved to {zip_path.parent}.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">package_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PIPELINE_CONFIG</span><span class="p">),</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PIPELINE_CONFIG</span><span class="p">))</span>

<span class="w">        </span><span class="n">datalink_metadata_yaml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">package_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">DATALINK_METADATA</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">datalink_metadata_yaml</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>

<span class="w">            </span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datalink_metadata_yaml</span><span class="p">),</span><span class="w"> </span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">DATALINK_METADATA</span><span class="p">)</span>

<span class="w">        </span><span class="n">_validate_with_schema</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;generated {RUNTIME_CONFIG}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">runtime_config</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;runtime.schema.json&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">with</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RUNTIME_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">file</span><span class="p">:</span>

<span class="w">            </span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">runtime_config</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>

<span class="w">        </span><span class="n">readme_html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">package_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">README_HTML</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">readme_html</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

<span class="w">            </span><span class="p">(</span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">README_HTML</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">readme_html</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

<span class="w">        </span><span class="n">telemetry_yaml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">package_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TELEMETRY_YAML</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">telemetry_yaml</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

<span class="w">            </span><span class="p">(</span><span class="n">runtime_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TELEMETRY_YAML</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">telemetry_yaml</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

<span class="w">        </span><span class="n">edge_package_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>

<span class="w">            </span><span class="c1"># One Pythonic Way to replace the last occurrence of &quot;_&quot; with &quot;-edge&quot;.</span>

<span class="w">            </span><span class="n">base_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">PurePath</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">&quot;-edge_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))),</span>

<span class="w">            </span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="n">root_dir</span><span class="o">=</span><span class="n">runtime_dir</span><span class="p">,</span>

<span class="w">            </span><span class="n">verbose</span><span class="o">=</span><span class="n">True</span><span class="p">,</span>

<span class="w">            </span><span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">))</span>

<span class="w">        </span><span class="n">sha256_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calc_sha</span><span class="p">(</span><span class="n">edge_package_path</span><span class="p">)</span>

<span class="w">        </span><span class="n">sha_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{sha256_hash}  {edge_package_path.name}&quot;</span>

<span class="w">        </span><span class="n">edge_package_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.sha256&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">sha_format</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">edge_package_path</span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="pipeline">Pipeline</h3>
<p><code>Pipeline</code> represents a pipeline configuration package with <code>Components</code> and wires to provide a data flow on the AI Inference Server.</p>
<p>The <code>Components</code> have inputs and outputs to transfer data to each other and the wires describe this data flow between them.
The package also contains configuration files required to deploy a pipeline on an Industrial Edge device.</p>
<p>A newly initialized <code>Pipeline</code> does not contain any <code>Component</code> or wire, only its name and version will be set.
The name and version together will define the name of the zip file when the package is saved.</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Pipeline</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="attributes">Attributes</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>str</td>
<td>Name of the package</td>
<td>None</td>
</tr>
<tr>
<td>version</td>
<td>str</td>
<td>Version of the package</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">Pipeline</span><span class="p">(</span><span class="n">PipelineData</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    `Pipeline` represents a pipeline configuration package with `Components` and wires to provide a data flow on the AI Inference Server.</span>

<span class="sd">    The `Components` have inputs and outputs to transfer data to each other and the wires describe this data flow between them.</span>

<span class="sd">    The package also contains configuration files required to deploy a pipeline on an Industrial Edge device.</span>

<span class="sd">    A newly initialized `Pipeline` does not contain any `Component` or wire, only its name and version will be set.</span>

<span class="sd">    The name and version together will define the name of the zip file when the package is saved.</span>

<span class="sd">    Args:</span>

<span class="sd">        name (str): Name of the package</span>

<span class="sd">        version (str): Version of the package</span>

<span class="sd">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">_wire_hash_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;{}.{} -&gt; {}.{}&quot;</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        A newly initialized `Pipeline` will contain no `Component` or wire, just its name and version will be set.</span>

<span class="sd">        The name and version will define together the name of the zip file when the package is saved.</span>

<span class="sd">        Args:</span>

<span class="sd">            name (str): Name of the package</span>

<span class="sd">            desc (str): Package description (optional)</span>

<span class="sd">            version (str): Version of the package</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PipelineReportWriter</span><span class="p">()</span>

<span class="w">        </span><span class="n">report_writer_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReportWriterHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="p">)</span>

<span class="w">        </span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">report_writer_handler</span><span class="p">)</span>

<span class="w">        </span><span class="n">_python_dependencies_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">report_writer_handler</span><span class="p">)</span>

<span class="w">        </span><span class="n">_wheelhouse_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">report_writer_handler</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_set_log_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">log_level</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">):</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log_level</span>

<span class="w">        </span><span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

<span class="w">    </span><span class="err">@</span><span class="n">staticmethod</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_components</span><span class="p">(</span><span class="n">components</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;Pipeline&quot;</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Creates a pipeline configuration from the given components.</span>

<span class="sd">        The components are linked in a linear sequence with inputs and outputs auto-wired based on the name of the inputs and outputs of the components.</span>

<span class="sd">        The inputs of the first component will be wired as the pipeline inputs and the outputs of the last component will be wired as the pipeline outputs.</span>

<span class="sd">        The components must have unique names. Two or more versions of the same component can not be packaged simultaneously without renaming them.</span>

<span class="sd">        Args:</span>

<span class="sd">            components (list): List of PythonComponents</span>

<span class="sd">            name (str): Name of the pipeline</span>

<span class="sd">            version (str): Version information of the pipeline. (Optional)</span>

<span class="sd">        Returns:</span>

<span class="sd">            Pipeline: Pipeline object with the auto-wired components</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pipeline</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">)</span>

<span class="w">        </span><span class="n">first_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">first_component</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline</span><span class="o">.</span><span class="n">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">component_input</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_input</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">first_component</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline</span><span class="o">.</span><span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">first_component</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

<span class="w">            </span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">wire_component</span><span class="p">,</span><span class="w"> </span><span class="n">wire_name</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">                </span><span class="n">try</span><span class="p">:</span>

<span class="w">                    </span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_wiring</span><span class="p">(</span><span class="n">wire_component</span><span class="p">,</span><span class="w"> </span><span class="n">wire_name</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">wire_name</span><span class="p">)</span>

<span class="w">                </span><span class="n">except</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">e</span><span class="p">:</span>

<span class="w">                    </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Output variable {wire_component}.{wire_name} couldn&#39;t be auto-wired.</span><span class="se">\n</span><span class="s2">Cause: {e}&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">unwired_variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;{component.name}.{x}&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">inputs</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{component.name}.{x}&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline</span><span class="o">.</span><span class="n">wiring</span><span class="p">)]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">unwired_variables</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">unwired_variables</span><span class="p">:</span>

<span class="w">                    </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Input variable {variable} couldn&#39;t be auto-wired.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">pipeline</span><span class="o">.</span><span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pipeline</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">str</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Textual representation of the configured package.</span>

<span class="sd">        The method shows the `Components` with their inputs, outputs and parameters as well as the wiring between these `Components`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            [str]: Textual representation of the package</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

<span class="w">        </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;[{self.__class__.__name__}] {self.name} ({version})</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{self.desc}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pipeline Parameters:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;- {name} ({parameter[&#39;type&#39;]}, default: &#39;{parameter[&#39;defaultValue&#39;]}&#39;){(&#39;: &#39; + parameter[&#39;desc&#39;]) if parameter.get(&#39;desc&#39;) is not None else &#39;&#39;}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pipeline Inputs:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">                </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;&gt; {name} ({input[&#39;type&#39;]}){&#39;: &#39; + input[&#39;desc&#39;] if input.get(&#39;desc&#39;) is not None else &#39;&#39;}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pipeline Outputs:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">                </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;&lt; {name} ({output[&#39;type&#39;]}){&#39;: &#39; + output[&#39;desc&#39;] if output.get(&#39;desc&#39;) is not None else &#39;&#39;}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="n">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">,</span><span class="w"> </span><span class="n">component_name</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metrics:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">metrics</span><span class="p">:</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;&lt; {name}{&#39;: &#39; + metric[&#39;desc&#39;] if metric.get(&#39;desc&#39;) is not None else &#39;&#39;}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">I/O Wiring:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;  {name} -&gt; {component}.{name}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">wire_hash</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">:</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;  {wire_hash}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;  {component}.{name} -&gt; {name}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">,</span><span class="w"> </span><span class="n">component_name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">metrics</span><span class="p">:</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;  {component_name}.{name} -&gt; {name}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Timeshifting:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;  Periodicity: {self.periodicity} ms</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;  References:</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

<span class="w">                    </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;  - {ref}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">text</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Defines an input variable on the given component as a pipeline input.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">try</span><span class="p">:</span>

<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>

<span class="w">        </span><span class="n">except</span><span class="w"> </span><span class="n">KeyError</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The component with input variable must exist in the pipeline.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline input already exists.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">delete_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes a pipeline input.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline input does not exist.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Defines an output variable on the given component as a pipeline output.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the output variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">try</span><span class="p">:</span>

<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>

<span class="w">        </span><span class="n">except</span><span class="w"> </span><span class="n">KeyError</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The component with output variable must exist in the pipeline.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline output already exists.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">delete_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes a pipeline output.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline output does not exist.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="n">Component</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Adds a `Component` to the pipeline configuration without any connection.</span>

<span class="sd">        The `Component` can be marked as an input or output component of the pipeline.</span>

<span class="sd">        When these parameters are True, the `Component` is responsible for input or output data of the pipeline.</span>

<span class="sd">        The component must have a unique name. Two or more versions of the same component can not be added to the same pipeline with the same component name.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (Component): `Component` to be added</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Component with name {component.name} already exists. Please rename the component.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">component</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_wiring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">from_component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">from_output</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">to_component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">to_input</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Creates a one-to-one connection between the input and output of two components.</span>

<span class="sd">        The method checks if the connection is allowed with the following requirements:</span>

<span class="sd">        - The components exist with the given inputs/outputs</span>

<span class="sd">        - The given inputs and outputs are not connected to any wire</span>

<span class="sd">        - The types of the connected input and output are compatible</span>

<span class="sd">        Args:</span>

<span class="sd">            from_component (str): Name of the component which provides data to the `to_component`</span>

<span class="sd">            from_output (str): Name of the output variable of the `from_component`</span>

<span class="sd">            to_component (str): Name of the component which consumes data from the `from_component`</span>

<span class="sd">            to_input (str): Name of the input variable of the `to_component`</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">from_component</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No component named &#39;{from_component}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">to_component</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No component named &#39;{to_component}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">from_output</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">from_component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Component &#39;{from_component}&#39; has no output named &#39;{from_output}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">to_input</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">to_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Component &#39;{to_component}&#39; has no input named &#39;{to_input}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">to_component</span><span class="p">,</span><span class="w"> </span><span class="n">to_input</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Input &#39;{to_input}&#39; of component &#39;{to_component}&#39; is already wired&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">_output_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">from_component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">from_output</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

<span class="w">        </span><span class="n">_input_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">to_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">to_input</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">_output_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">_input_type</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;Output and input types do not match&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">wire_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_wire_hash_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_component</span><span class="p">,</span><span class="w"> </span><span class="n">from_output</span><span class="p">,</span><span class="w"> </span><span class="n">to_component</span><span class="p">,</span><span class="w"> </span><span class="n">to_input</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">[</span><span class="n">wire_hash</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s2">&quot;fromComponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">from_component</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;fromOutput&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">from_output</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;toComponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">to_component</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;toInput&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">to_input</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_wire_for_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">output_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Searches for the wire which connects a component with `component_name` as data provider through its output with name output_name.</span>

<span class="sd">        Args:</span>

<span class="sd">            component_name (str): Name of the data provider component.</span>

<span class="sd">            output_name (str): Name of the output variable of `component_name`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            [dict]: Wire which contains the data provider and receiver with their names and the names of their variables.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">wires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;fromComponent&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">component_name</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;fromOutput&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">output_name</span><span class="p">]</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">wires</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">wires</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">None</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">input_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Searches for the wire which connects a component with `component_name` as data consumer through its input with name `input_name`.</span>

<span class="sd">        Args:</span>

<span class="sd">            component_name (str): Name of the data consumer component.</span>

<span class="sd">            input_name (str): Name of the input variable of `component_name`.</span>

<span class="sd">        Returns:</span>

<span class="sd">            dict: Wire which contains the data provider and receiver with their names and the names of their variables.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">wires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;toComponent&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">component_name</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;toInput&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">input_name</span><span class="p">]</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">wires</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">wires</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">None</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">delete_input_wire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">with_input</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes an existing connection between two components.</span>

<span class="sd">        The connection must be given with the name of the consumer component and its input variable.</span>

<span class="sd">        If an inter signal alignment reference variable is affected it cannot be deleted.</span>

<span class="sd">        By default, the input variable will be also deleted.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component which has the input given the name variable</span>

<span class="sd">            variable (str): Name of the input variable on the component which connected by the wire</span>

<span class="sd">            with_input (bool, optional): If set, the input variable will be also deleted from the component. Defaults to True.</span>

<span class="sd">        Raises:</span>

<span class="sd">            AssertionError: When the variable acts as inter signal alignment reference, it cannot be deleted, and an `AssertionError` will be raised.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">wire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">wire</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;There is no wiring for input &#39;{variable}&#39; of component &#39;{component}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;Inter signal alignment reference variables can not be deleted.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">wire_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_wire_hash_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">])</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wire_hash</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">with_input</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">delete_input</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">packages</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        @Deprecated, reason: components can have different Python versions and/or platform, therefore it&#39;s better to specify dependencies on a case-by-case basis.</span>

<span class="sd">        Collects the given Python packages with their versions from the executing Python environment and add them to all components of type `PythonComponent`.</span>

<span class="sd">        This step is necessary in order to execute the pipeline configuration on the Edge side.</span>

<span class="sd">        The method can be called multiple times but each time the previously-collected dependencies are cleared.</span>

<span class="sd">        The reason for this is to ensure a consistent dependency list for the `requirements.txt` file when the package is saved.</span>

<span class="sd">        Args:</span>

<span class="sd">            packages (list): List of the necessary python packages to execute the script defined by self.entrypoint</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">python_components</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">]</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">python_components</span><span class="p">:</span>

<span class="w">            </span><span class="n">component</span><span class="o">.</span><span class="n">add_dependencies</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">set_timeshifting_periodicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">periodicity</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Enables inter-signal alignment with the given sampling period.</span>

<span class="sd">        With inter-signal alignment enabled, the AI Inference Server collects data for different input variables before it triggers the model.</span>

<span class="sd">        By default, `startingPoint` property is set to `First timestamp`, which means that inter-signal alignment is started at the</span>

<span class="sd">        first incoming value for any input variable.</span>

<span class="sd">        This property can be changed to `Signal reference` by adding inter-signal alignment reference variables</span>

<span class="sd">        via the `add_timeshifting_reference(..)` method. In this case, inter-signal alignment is started when the first value arrives</span>

<span class="sd">        for the defined input variables.</span>

<span class="sd">        Args:</span>

<span class="sd">            periodicity (int): Periodicity time in milliseconds for the AI Inference Server to perform inter-signal alignment. Valid range is [10, 2^31).</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">periodicity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">periodicity</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">periodicity</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">))):</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;Inter signal alignment periodicity must be an integer and in range [10, 2^31)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periodicity</span>

<span class="w">        </span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Inter signal alignment periodicity has been set to {self.periodicity}.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_timeshifting_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">reference</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Enables signal alignment mode `Signal reference` by declaring input variables as reference variables.</span>

<span class="sd">        Args:</span>

<span class="sd">            reference (str): Variable name to be added to `self.timeshift_reference` list.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;There is no input variable defined with name &#39;{reference}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Reference variable with name &#39;{reference}&#39; has been already added.&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">remove_timeshifting_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">reference</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Removes previously-defined inter-signal alignment reference variables.</span>

<span class="sd">        If no reference variables remain, the `startingPoint` will be `First timestamp`.</span>

<span class="sd">        Args:</span>

<span class="sd">            reference (str): Variable name to be removed from `self.timeshift_reference` list.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Reference variable with name {&#39;reference&#39;} does not exist.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_pipeline_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Saves the information on the composed pipeline configuration package into a YAML file.</span>

<span class="sd">        This YAML file describes the components and the data flow between them for the AI Inference Server.</span>

<span class="sd">        The file is created in the `destination` folder with name `pipeline_config.yml`</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

<span class="w">        </span><span class="n">filtered_pipeline_outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;imageset&#39;</span><span class="p">]</span>

<span class="w">        </span><span class="n">metric_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

<span class="w">        </span><span class="n">pipeline_inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>

<span class="w">            </span><span class="s1">&#39;metric&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">False</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">filtered_pipeline_outputs</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">field</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;String&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;metric&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">True</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;topic&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;/siemens/edge/aiinference/{self.name}/{version}/metrics/{component_name}/{field}&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">metric_fields</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline_dag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{wire[&#39;fromComponent&#39;]}.{wire[&#39;fromOutput&#39;]}&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{wire[&#39;toComponent&#39;]}.{wire[&#39;toInput&#39;]}&quot;</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wire</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="w">        </span><span class="n">pipeline_dag</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s1">&#39;Databus.{name}&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s1">&#39;{component_name}.{name}&#39;</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline_dag</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s1">&#39;{component_name}.{name}&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s1">&#39;Databus.{name}&#39;</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">filtered_pipeline_outputs</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline_dag</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[{</span>

<span class="w">            </span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s1">&#39;{component_name}.{field}&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="s1">&#39;Databus.{field}&#39;</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">metric_fields</span><span class="p">]</span>

<span class="w">        </span><span class="n">config_yml_content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s1">&#39;fileFormatVersion&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1.2.0&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;dataFlowPipelineInfo&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="s1">&#39;author&#39;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>

<span class="w">                </span><span class="s1">&#39;createdOn&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>

<span class="w">                </span><span class="s1">&#39;dataFlowPipelineVersion&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">version</span><span class="p">,</span>

<span class="w">                </span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Created by AI SDK&#39;</span><span class="p">,</span>

<span class="w">                </span><span class="s1">&#39;projectName&#39;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>

<span class="w">                </span><span class="s1">&#39;packageId&#39;</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>

<span class="w">            </span><span class="p">},</span>

<span class="w">            </span><span class="s1">&#39;dataFlowPipeline&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="s1">&#39;components&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">component</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>

<span class="w">                </span><span class="s1">&#39;pipelineDag&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">pipeline_dag</span><span class="p">,</span>

<span class="w">                </span><span class="s1">&#39;pipelineInputs&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">pipeline_inputs</span><span class="p">,</span>

<span class="w">                </span><span class="s1">&#39;pipelineOutputs&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">pipeline_outputs</span><span class="p">,</span>

<span class="w">            </span><span class="p">},</span>

<span class="w">            </span><span class="s1">&#39;packageType&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;full&#39;</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">config_yml_content</span><span class="p">[</span><span class="s2">&quot;dataFlowPipeline&quot;</span><span class="p">][</span><span class="s2">&quot;pipelineParameters&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s2">&quot;topicBased&quot;</span><span class="p">]:</span>

<span class="w">                    </span><span class="n">config_yml_content</span><span class="p">[</span><span class="s2">&quot;dataFlowPipeline&quot;</span><span class="p">][</span><span class="s2">&quot;pipelineParameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

<span class="w">                        </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>

<span class="w">                        </span><span class="s1">&#39;defaultValue&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;defaultValue&#39;</span><span class="p">],</span>

<span class="w">                        </span><span class="s1">&#39;topicBased&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;topicBased&#39;</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;valueTopic&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;valueTopic&#39;</span><span class="p">]</span>

<span class="w">                    </span><span class="p">})</span>

<span class="w">                </span><span class="k">else</span><span class="p">:</span>

<span class="w">                    </span><span class="n">config_yml_content</span><span class="p">[</span><span class="s2">&quot;dataFlowPipeline&quot;</span><span class="p">][</span><span class="s2">&quot;pipelineParameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>

<span class="w">                        </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>

<span class="w">                        </span><span class="s1">&#39;defaultValue&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;defaultValue&#39;</span><span class="p">]</span>

<span class="w">                    </span><span class="p">})</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">config_yml_content</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save_pipeline_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Saves the information about the composed pipeline configuration package into a YAML file.</span>

<span class="sd">        This YAML file describes the components and the data flow between them for AI Inference Server.</span>

<span class="sd">        The file will be created in the `destination` folder with name `pipeline_config.yml`</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (path-like): Path of the `destination` directory.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">with</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PIPELINE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="p">:</span>

<span class="w">            </span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pipeline_config</span><span class="p">(),</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_datalink_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        The method generates metadata information based on available information.</span>

<span class="sd">        Returns:</span>

<span class="sd">            dict: Dictionary with the necessary information for the AI Inference Server.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">timeshifting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">False</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;periodicity&quot;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;startingPoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">timeshifting</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span>

<span class="w">            </span><span class="n">timeshifting</span><span class="p">[</span><span class="s2">&quot;startingPoint&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;First timestamp&#39;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">timeshifting</span><span class="p">[</span><span class="s2">&quot;startingPoint&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Signal reference&#39;</span>

<span class="w">        </span><span class="n">exported_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s2">&quot;fileFormatVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;createdOn&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>

<span class="w">            </span><span class="s2">&quot;updatedOn&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>

<span class="w">            </span><span class="s2">&quot;timeShifting&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">timeshifting</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>

<span class="w">                </span><span class="p">{</span>

<span class="w">                    </span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">_name</span><span class="p">,</span>

<span class="w">                    </span><span class="s1">&#39;mapping&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">                    </span><span class="s1">&#39;timeShiftingReference&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">_name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">,</span>

<span class="w">                    </span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">_name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_component</span><span class="p">,</span><span class="w"> </span><span class="n">_name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>

<span class="w">            </span><span class="p">]</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">exported_metadata</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save_datalink_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Saves metadata for pipeline input variables.</span>

<span class="sd">        This method saves metadata for the AI Inference Server into a YAML file.</span>

<span class="sd">        This metadata determines how the AI Inference Server feeds input to the pipeline, especially inter-signal alignment.</span>

<span class="sd">        The file is created in the `destination` folder with the name `datalink_metadata.yml`</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (path-like): Path of the destination directory.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">with</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">DATALINK_METADATA</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="p">:</span>

<span class="w">            </span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_datalink_metadata</span><span class="p">(),</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save_telemetry_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Save telemetry data to a specified destination.</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (Path): The path where the telemetry data should be saved.</span>

<span class="sd">        Returns:</span>

<span class="sd">            None</span>

<span class="sd">        Raises:</span>

<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">telemetry_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TELEMETRY_YAML</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">][</span><span class="s2">&quot;os&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">][</span><span class="s2">&quot;release&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">][</span><span class="s2">&quot;python_version&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span>

<span class="w">        </span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;locals: {locals()}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;jupyter&quot;</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">locals</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;__IPYTHON__&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;get_ipython&quot;</span><span class="p">])</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;gitlab_ci&quot;</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s2">&quot;GITLAB_CI&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;azure_devops&quot;</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s2">&quot;TF_BUILD&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">][</span><span class="s2">&quot;github_actions&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s2">&quot;GITHUB_ACTIONS&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;simaticai&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;vep-template-sdk&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">try</span><span class="p">:</span>

<span class="w">            </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;simaticai&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;simaticai&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>

<span class="w">        </span><span class="n">except</span><span class="w"> </span><span class="n">pkg_resources</span><span class="o">.</span><span class="n">DistributionNotFound</span><span class="p">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;simaticai package not found&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">try</span><span class="p">:</span>

<span class="w">            </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;industrial_ai&quot;</span><span class="p">][</span><span class="s2">&quot;vep-template-sdk&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;vep-template-sdk&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>

<span class="w">        </span><span class="n">except</span><span class="w"> </span><span class="n">pkg_resources</span><span class="o">.</span><span class="n">DistributionNotFound</span><span class="p">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;vep-template-sdk package not found&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">][</span><span class="s2">&quot;python_versions&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">python_version</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">],</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">)))</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">][</span><span class="s2">&quot;file_extensions&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.yml&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.yaml&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.html&quot;</span><span class="p">]))</span>

<span class="w">        </span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">telemetry_data</span><span class="p">,</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">telemetry_path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;w&#39;</span><span class="p">))</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Validates whether the package configuration is compatible with the expected runtime environment.</span>

<span class="sd">        The method verifies:</span>

<span class="sd">        - If the package has at least one component</span>

<span class="sd">        - If all wires create connections between existing components and their variables</span>

<span class="sd">        - If metadata is defined and valid.</span>

<span class="sd">        - If a package with the same name already exists in the `destination` folder. In this case a warning message appears and the `save(..)` method overwrites the existing package.</span>

<span class="sd">        - If the package has multiple components and if they are using the same Python version</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (str, optional): Path of the expected destination folder. Defaults to &quot;.&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The package must have at least one component.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">outputBatch</span><span class="p">:</span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The component &#39;{name}&#39; has pipeline output defined with variable name &#39;{variable}&#39;. </span><span class="se">\</span>

<span class="w">                                      </span><span class="n">None</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="n">output</span><span class="o">.</span><span class="s2">&quot;)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">wire_hash</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>

<span class="w">            </span><span class="n">wire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">[</span><span class="n">wire_hash</span><span class="p">]</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">_check_wiring</span><span class="p">(</span><span class="n">wire</span><span class="p">,</span><span class="w"> </span><span class="n">wire_hash</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline_inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">variable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>

<span class="w">        </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">variable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline_inputs</span><span class="p">):</span>

<span class="w">            </span><span class="n">conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set</span><span class="p">(</span><span class="n">pipeline_inputs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="n">pipeline_outputs</span><span class="p">))</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Pipeline input and output variables must be unique. Conflicting variables: {conflicts}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_check_timeshifting</span><span class="p">()</span>

<span class="w">        </span><span class="n">package_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{self.name}_{version}&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">package_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Target folder ({package_path}) already exists! Unless changing the package name the package could be invalid and your files will be overwritten!&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">python_versions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set</span><span class="p">()</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">],</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">):</span>

<span class="w">                </span><span class="n">python_versions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">python_version</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">python_versions</span><span class="p">)):</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The use of multiple python version in a single pipeline is not recommended. We recommend using only one of the supported versions, which are Python 3.10 or 3.11.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Package &#39;{self.name}&#39; is valid and ready to save.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_check_timeshifting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">periodicity</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;When using inter signal alignment reference variables, the periodicity must be set.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_check_wiring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">wire</span><span class="p">,</span><span class="w"> </span><span class="n">wire_hash</span><span class="p">):</span>

<span class="w">        </span><span class="n">error_messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;From component {wire[&#39;fromComponent&#39;]} does not exist&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;To component {wire[&#39;toComponent&#39;]} does not exist&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">]</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Output variable {wire[&#39;fromOutput&#39;]} does not exist on component {wire[&#39;fromComponent&#39;]}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">]</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Input variable {wire[&#39;toInput&#39;]} does not exist on component {wire[&#39;toComponent&#39;]}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">error_messages</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">from_type_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

<span class="w">            </span><span class="n">to_type_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">from_type_</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">to_type_</span><span class="p">:</span>

<span class="w">                </span><span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The types of input and output variables does not match for wiring {wire_hash}.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">error_messages</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wire_hash</span><span class="p">)</span>

<span class="w">            </span><span class="n">error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;The wire has been deleted, please check the variables and re-create the connection.&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">error_messages</span><span class="o">.</span><span class="n">__str__</span><span class="p">())</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">package_id</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Path</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        @Deprecated, reason: only edge package generation will be supported in the future. Use export instead.</span>

<span class="sd">        Saves the assembled package in a zip format.</span>

<span class="sd">        The name of the file is defined as `{package_name}_{package_version}.zip`.</span>

<span class="sd">        If a file with such a name already exists in the `destination` folder, it gets overwritten and a warning message appears.</span>

<span class="sd">        The package is also available as a subfolder on the destination path with the name `{package_name}_{package_version}`.</span>

<span class="sd">        If the assembled content does not meet the expected one, this content can be changed and simply packed into a zip file.</span>

<span class="sd">        The package contains files and folders in the following structure:</span>

<span class="sd">        - Package folder with name `{package_name}_{package_version}`</span>

<span class="sd">            - `datalink-metadata.yml`</span>

<span class="sd">            - `pipeline-config.yml`</span>

<span class="sd">            - Component folder with name `{component_name}`</span>

<span class="sd">            When the component is a `PythonComponent`, this folder contains:</span>

<span class="sd">            - `requirements.txt`</span>

<span class="sd">            - Entrypoint script defined by the entrypoint of the component</span>

<span class="sd">            - Extra files as added to the specified folders</span>

<span class="sd">            - Source folder with name `src` with necessary python scripts</span>

<span class="sd">        If a package ID is specified, and a package with the same ID and version is already present in the `destination` folder,</span>

<span class="sd">        an error is raised.</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (str, optional): Target directory for saving the package. Defaults to &quot;.&quot;.</span>

<span class="sd">            package_id (UUID): The optional package ID. If None, a new UUID is generated.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_set_save_version_and_package_id</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">),</span><span class="w"> </span><span class="n">package_id</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">package_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{name}_{self.save_version}&quot;</span>

<span class="w">        </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">package_name</span>

<span class="w">        </span><span class="n">destination</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="n">True</span><span class="p">,</span><span class="w"> </span><span class="n">exist_ok</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># Save</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span><span class="w"> </span><span class="n">False</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">],</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">):</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="o">.</span><span class="n">add_direct_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">python_dependencies</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">save_datalink_metadata</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline_config</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">p_page</span><span class="o">.</span><span class="n">save_readme_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">save_telemetry_data</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">zip_destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>

<span class="w">            </span><span class="n">base_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">package_name</span><span class="p">),</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="n">root_dir</span><span class="o">=</span><span class="n">destination</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="n">base_dir</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>

<span class="w">            </span><span class="n">verbose</span><span class="o">=</span><span class="n">True</span><span class="p">,</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">zip_destination</span><span class="p">)</span><span class="w">  </span><span class="c1"># zipped package size in bytes</span>

<span class="w">        </span><span class="n">pipeline_size_GB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;{:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipeline_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline_size_limit_GB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;{:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PIPELINE_SIZE_LIMIT</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">pipeline_size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">PIPELINE_SIZE_LIMIT</span><span class="p">:</span>

<span class="w">            </span><span class="n">error_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;Pipeline size {pipeline_size} bytes ({pipeline_size_GB} GB) exceeds the limit of &quot;</span><span class="w"> </span>\

<span class="w">                        </span><span class="n">f</span><span class="s2">&quot;{PIPELINE_SIZE_LIMIT} bytes ({pipeline_size_limit_GB} GB). &quot;</span><span class="w"> </span>\

<span class="w">                        </span><span class="s2">&quot;Please remove unnecessary files and dependencies and try again.&quot;</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">RuntimeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Path</span><span class="p">(</span><span class="n">zip_destination</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_set_save_version_and_package_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">package_id</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">],</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>

<span class="w">        </span><span class="n">previous_versions_and_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_get_versions_and_package_ids_of_existing_packages</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">previous_versions</span><span class="p">,</span><span class="w"> </span><span class="n">previous_package_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">previous_versions_and_ids</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">previous_versions_and_ids</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">([],</span><span class="w"> </span><span class="p">[])</span>

<span class="w">        </span><span class="c1"># if package id is provided, we use that</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">package_id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">package_id</span>

<span class="w">        </span><span class="c1"># auto-generate package id if not provided</span>

<span class="w">        </span><span class="k">else</span><span class="p">:</span>

<span class="w">            </span><span class="n">previous_package_ids_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">pkg_id</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pkg_id</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">previous_package_ids</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">pkg_id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">                </span><span class="n">previous_package_ids_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">previous_package_ids_set</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

<span class="w">            </span><span class="k">elif</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">previous_package_ids_set</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">package_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">previous_package_ids_set</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

<span class="w">            </span><span class="k">else</span><span class="p">:</span>

<span class="w">                </span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Multiple package IDs found in the destination folder: {previous_package_ids_set}. Set a package ID.&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">RuntimeError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Multiple package IDs found in the destination folder: {previous_package_ids_set}. Set a package ID.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># Preference #1: use the provided version</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">version</span>

<span class="w">        </span><span class="c1"># Preference #2: use the version set at init time</span>

<span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">init_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">init_version</span>

<span class="w">        </span><span class="c1"># Preference #3: auto-generate version</span>

<span class="w">        </span><span class="k">else</span><span class="p">:</span>

<span class="w">            </span><span class="n">previous_decimal_versions_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">previous_versions</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">v</span><span class="o">.</span><span class="n">isdecimal</span><span class="p">()}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">previous_decimal_versions_set</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>

<span class="w">            </span><span class="k">else</span><span class="p">:</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">save_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">previous_decimal_versions_set</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># check if the package zip already exists</span>

<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">package_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{name}_{self.save_version}&quot;</span>

<span class="w">        </span><span class="n">package_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{package_name}.zip&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">package_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Target package with version &#39;{self.save_version}&#39; already exists: &#39;{package_file}. The package will be overwritten.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">edge_package_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="s2">&quot;{name}-edge_{self.save_version}.zip&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">edge_package_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Target package with version &#39;{self.save_version}&#39; already exists: &#39;{edge_package_file}. The package will be overwritten.&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_get_versions_and_package_ids_of_existing_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]]]:</span>

<span class="w">        </span><span class="n">package_versions_and_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">destination</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{self.name.replace(&#39; &#39;, &#39;-&#39;)}*.zip&quot;</span><span class="p">):</span>

<span class="w">            </span><span class="n">with</span><span class="w"> </span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">zip_file</span><span class="p">:</span>

<span class="w">                </span><span class="n">config_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">zip_file</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;pipeline_config.yml&quot;</span><span class="p">))</span>

<span class="w">                </span><span class="n">with</span><span class="w"> </span><span class="n">zip_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">config_file</span><span class="p">:</span>

<span class="w">                    </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span><span class="w"> </span><span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeLoader</span><span class="p">)</span>

<span class="w">                    </span><span class="n">pipeline_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataFlowPipelineInfo&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>

<span class="w">                    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipeline_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">None</span><span class="p">)</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>

<span class="w">                        </span><span class="k">continue</span>

<span class="w">                    </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipeline_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dataFlowPipelineVersion&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">None</span><span class="p">)</span>

<span class="w">                    </span><span class="n">package_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipeline_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;packageId&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">None</span><span class="p">)</span>

<span class="w">                    </span><span class="n">package_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">package_id</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">package_id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">None</span>

<span class="w">                    </span><span class="n">package_versions_and_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">package_id</span><span class="p">))</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">package_versions_and_ids</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">package_id</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Path</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Export a runnable pipeline package.</span>

<span class="sd">        Args:</span>

<span class="sd">            destination (str): optional target directory for saving the package. Defaults to &quot;.&quot;.</span>

<span class="sd">            package_id (UUID): optional package ID. If None, a new UUID is generated.</span>

<span class="sd">            version (str): optional version. If None, an automatic version number is generated.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">config_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span>

<span class="w">        </span><span class="n">try</span><span class="p">:</span>

<span class="w">            </span><span class="n">config_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span><span class="w"> </span><span class="n">package_id</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)</span>

<span class="w">            </span><span class="n">runtime_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convert_package</span><span class="p">(</span><span class="n">config_package</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">report_writer</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">runtime_package</span>

<span class="w">        </span><span class="n">finally</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">config_package</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">                </span><span class="n">Path</span><span class="p">(</span><span class="n">config_package</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">default_value</span><span class="p">,</span><span class="w"> </span><span class="n">type_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">topic_based</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">False</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Adds a parameter to the pipeline configuration, which alters the behavior of the pipeline.</span>

<span class="sd">        The parameter&#39;s default value and its properties are saved in the pipeline configuration</span>

<span class="sd">        and the value of the parameter can later be changed on AI Inference Server.</span>

<span class="sd">        Args:</span>

<span class="sd">            name (str): Name of the parameter</span>

<span class="sd">            desc (str): Description of the parameter (optional)</span>

<span class="sd">            type_name (str, optional): Data type of the parameter. Defaults to &quot;String&quot;.</span>

<span class="sd">            default_value (str): Default value of the parameter</span>

<span class="sd">            topic_based (bool, optional): If true, the parameter can be updated from a message queue.</span>

<span class="sd">        Raises:</span>

<span class="sd">            ValueError:</span>

<span class="sd">                When:</span>

<span class="sd">                - the default value of the parameter is not of the specified data type (`type_name`) or</span>

<span class="sd">                - the specified data type itself is not an allowed data type (not a part of `parameter_types` dict) or</span>

<span class="sd">                - the specified data type is not given in the right format or</span>

<span class="sd">                - the type of the given `topic_based` parameter is not `bool`.</span>

<span class="sd">                - the name of the parameter starts with `__AI_IS_` prefix. These are reserved parameters by AI Inference Server</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">parameter_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s2">&quot;String&quot;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;str&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;Integer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;int&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;Double&quot;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;float&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;Boolean&quot;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;bool&#39;</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">default_value_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__AI_IS_&quot;</span><span class="p">):</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="s2">&quot;Pipeline parameters with `__AI_IS_` prefix should not be specified in the pipeline configuration. However, the entrypoint script should be able to handle them in the `update_parameters` method.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">type_name</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameter_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The given value type is not supported. Please use one of these: {parameter_types.keys()}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">default_value_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">parameter_types</span><span class="p">[</span><span class="n">type_name</span><span class="p">]:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The given value type does not match the type of &#39;{type_name}&#39;. Please use the correct one from these: {list(parameter_types.keys())}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">topic_based</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="p">):</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="s2">&quot;Type of the given `topic_based` parameter is not `bool`.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">type_name</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">default_value</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;topicBased&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">topic_based</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;valueTopic&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">desc</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;desc&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>simaticai.deploy.pipeline_data.PipelineData</li>
</ul>
<h4 id="static-methods">Static methods</h4>
<h4 id="from_components">from_components</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_components</span><span class="p">(</span>
    <span class="n">components</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pipeline&#39;</span>
</code></pre></div>

<p>Creates a pipeline configuration from the given components.</p>
<p>The components are linked in a linear sequence with inputs and outputs auto-wired based on the name of the inputs and outputs of the components.
The inputs of the first component will be wired as the pipeline inputs and the outputs of the last component will be wired as the pipeline outputs.
The components must have unique names. Two or more versions of the same component can not be packaged simultaneously without renaming them.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>components</td>
<td>list</td>
<td>List of PythonComponents</td>
<td>None</td>
</tr>
<tr>
<td>name</td>
<td>str</td>
<td>Name of the pipeline</td>
<td>None</td>
</tr>
<tr>
<td>version</td>
<td>str</td>
<td>Version information of the pipeline. (Optional)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pipeline</td>
<td>Pipeline object with the auto-wired components</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@staticmethod</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">from_components</span><span class="p">(</span><span class="nl">components</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="err">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">&quot;Pipeline&quot;</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Creates a pipeline configuration from the given components.</span>

<span class="ss">        The components are linked in a linear sequence with inputs and outputs auto-wired based on the name of the inputs and outputs of the components.</span>

<span class="ss">        The inputs of the first component will be wired as the pipeline inputs and the outputs of the last component will be wired as the pipeline outputs.</span>

<span class="ss">        The components must have unique names. Two or more versions of the same component can not be packaged simultaneously without renaming them.</span>

<span class="ss">        Args:</span>

<span class="ss">            components (list): List of PythonComponents</span>

<span class="ss">            name (str): Name of the pipeline</span>

<span class="ss">            version (str): Version information of the pipeline. (Optional)</span>

<span class="ss">        Returns:</span>

<span class="ss">            Pipeline: Pipeline object with the auto-wired components</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pipeline</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="o">=</span><span class="k">desc</span><span class="p">)</span>

<span class="w">        </span><span class="n">first_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">components</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">        </span><span class="n">pipeline</span><span class="p">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">first_component</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline</span><span class="p">.</span><span class="n">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">(first_component.name, component_input) for component_input in first_component.inputs</span><span class="o">]</span>

<span class="w">        </span><span class="n">pipeline</span><span class="p">.</span><span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">(first_component.name, output) for output in first_component.outputs</span><span class="o">]</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">components</span><span class="o">[</span><span class="n">1:</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="n">pipeline</span><span class="p">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">wire_component</span><span class="p">,</span><span class="w"> </span><span class="n">wire_name</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline</span><span class="p">.</span><span class="nl">outputs</span><span class="p">:</span>

<span class="w">                </span><span class="k">try</span><span class="err">:</span>

<span class="w">                    </span><span class="n">pipeline</span><span class="p">.</span><span class="n">add_wiring</span><span class="p">(</span><span class="n">wire_component</span><span class="p">,</span><span class="w"> </span><span class="n">wire_name</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">wire_name</span><span class="p">)</span>

<span class="w">                </span><span class="ow">except</span><span class="w"> </span><span class="k">Exception</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span>

<span class="w">                    </span><span class="n">_logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Output variable {wire_component}.{wire_name} couldn&#39;t be auto-wired.\nCause: {e}&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">unwired_variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">f&#39;{component.name}.{x}&#39; for x in component.inputs if not any(s.endswith(f&#39;{component.name}.{x}&#39;) for s in pipeline.wiring)</span><span class="o">]</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">unwired_variables</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="k">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">unwired_variables</span><span class="p">:</span>

<span class="w">                    </span><span class="n">_logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Input variable {variable} couldn&#39;t be auto-wired.\n&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">pipeline</span><span class="p">.</span><span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">(component.name, output) for output in component.outputs</span><span class="o">]</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pipeline</span>
</code></pre></div>

</details>
<h4 id="methods">Methods</h4>
<h4 id="add_component">add_component</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_component</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">:</span> <span class="n">simaticai</span><span class="o">.</span><span class="n">deploy</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">Component</span>
<span class="p">)</span>
</code></pre></div>

<p>Adds a <code>Component</code> to the pipeline configuration without any connection.</p>
<p>The <code>Component</code> can be marked as an input or output component of the pipeline.
When these parameters are True, the <code>Component</code> is responsible for input or output data of the pipeline.
The component must have a unique name. Two or more versions of the same component can not be added to the same pipeline with the same component name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component</td>
<td>Component</td>
<td><code>Component</code> to be added</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_component</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">component</span><span class="o">:</span><span class="w"> </span><span class="k">Component</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Adds a `Component` to the pipeline configuration without any connection.</span>

<span class="s2">        The `Component` can be marked as an input or output component of the pipeline.</span>

<span class="s2">        When these parameters are True, the `Component` is responsible for input or output data of the pipeline.</span>

<span class="s2">        The component must have a unique name. Two or more versions of the same component can not be added to the same pipeline with the same component name.</span>

<span class="s2">        Args:</span>

<span class="s2">            component (Component): `Component` to be added</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">component</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Component with name {component.name} already exists. Please rename the component.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="err">[</span><span class="k">component</span><span class="p">.</span><span class="k">name</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">component</span>
</code></pre></div>

</details>
<h4 id="add_dependencies">add_dependencies</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_dependencies</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">packages</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">)</span>
</code></pre></div>

<p>@Deprecated, reason: components can have different Python versions and/or platform, therefore it's better to specify dependencies on a case-by-case basis.</p>
<p>Collects the given Python packages with their versions from the executing Python environment and add them to all components of type <code>PythonComponent</code>.
This step is necessary in order to execute the pipeline configuration on the Edge side.
The method can be called multiple times but each time the previously-collected dependencies are cleared.
The reason for this is to ensure a consistent dependency list for the <code>requirements.txt</code> file when the package is saved.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>packages</td>
<td>list</td>
<td>List of the necessary python packages to execute the script defined by self.entrypoint</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_dependencies</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">packages</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        @Deprecated, reason: components can have different Python versions and/or platform, therefore it&#39;s better to specify dependencies on a case-by-case basis.</span>

<span class="ss">        Collects the given Python packages with their versions from the executing Python environment and add them to all components of type `PythonComponent`.</span>

<span class="ss">        This step is necessary in order to execute the pipeline configuration on the Edge side.</span>

<span class="ss">        The method can be called multiple times but each time the previously-collected dependencies are cleared.</span>

<span class="ss">        The reason for this is to ensure a consistent dependency list for the `requirements.txt` file when the package is saved.</span>

<span class="ss">        Args:</span>

<span class="ss">            packages (list): List of the necessary python packages to execute the script defined by self.entrypoint</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">python_components</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">self.components[name</span><span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">name</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">PythonComponent</span><span class="err">]</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">python_components</span><span class="p">:</span>

<span class="w">            </span><span class="n">component</span><span class="p">.</span><span class="n">add_dependencies</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="add_input">add_input</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_input</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">,</span>
    <span class="n">variable</span>
<span class="p">)</span>
</code></pre></div>

<p>Defines an input variable on the given component as a pipeline input.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component</td>
<td>str</td>
<td>Name of the component</td>
<td>None</td>
</tr>
<tr>
<td>variable</td>
<td>str</td>
<td>Name of the input variable</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_input</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Defines an input variable on the given component as a pipeline input.</span>

<span class="ss">        Args:</span>

<span class="ss">            component (str): Name of the component</span>

<span class="ss">            variable (str): Name of the input variable</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">inputs</span><span class="o">[</span><span class="n">variable</span><span class="o">]</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">KeyError</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="ss">&quot;The component with input variable must exist in the pipeline.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">inputs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="ss">&quot;The pipeline input already exists.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">inputs</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="add_output">add_output</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_output</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">,</span>
    <span class="n">variable</span>
<span class="p">)</span>
</code></pre></div>

<p>Defines an output variable on the given component as a pipeline output.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component</td>
<td>str</td>
<td>Name of the component</td>
<td>None</td>
</tr>
<tr>
<td>variable</td>
<td>str</td>
<td>Name of the output variable</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_output</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Defines an output variable on the given component as a pipeline output.</span>

<span class="ss">        Args:</span>

<span class="ss">            component (str): Name of the component</span>

<span class="ss">            variable (str): Name of the output variable</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">outputs</span><span class="o">[</span><span class="n">variable</span><span class="o">]</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">KeyError</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="ss">&quot;The component with output variable must exist in the pipeline.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">outputs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="ss">&quot;The pipeline output already exists.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">outputs</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="add_parameter">add_parameter</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_parameter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">default_value</span><span class="p">,</span>
    <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;String&#39;</span><span class="p">,</span>
    <span class="n">topic_based</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Adds a parameter to the pipeline configuration, which alters the behavior of the pipeline.</p>
<p>The parameter's default value and its properties are saved in the pipeline configuration
and the value of the parameter can later be changed on AI Inference Server.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>str</td>
<td>Name of the parameter</td>
<td>None</td>
</tr>
<tr>
<td>desc</td>
<td>str</td>
<td>Description of the parameter (optional)</td>
<td>None</td>
</tr>
<tr>
<td>type_name</td>
<td>str</td>
<td>Data type of the parameter. Defaults to "String".</td>
<td>"String"</td>
</tr>
<tr>
<td>default_value</td>
<td>str</td>
<td>Default value of the parameter</td>
<td>None</td>
</tr>
<tr>
<td>topic_based</td>
<td>bool</td>
<td>If true, the parameter can be updated from a message queue.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ValueError</td>
<td>When:<br/>- the default value of the parameter is not of the specified data type (<code>type_name</code>) or<br/>- the specified data type itself is not an allowed data type (not a part of <code>parameter_types</code> dict) or<br/>- the specified data type is not given in the right format or<br/>- the type of the given <code>topic_based</code> parameter is not <code>bool</code>.<br/>- the name of the parameter starts with <code>__AI_IS_</code> prefix. These are reserved parameters by AI Inference Server</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_parameter</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">default_value</span><span class="p">,</span><span class="w"> </span><span class="n">type_name</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">topic_based</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Adds a parameter to the pipeline configuration, which alters the behavior of the pipeline.</span>

<span class="s2">        The parameter&#39;s default value and its properties are saved in the pipeline configuration</span>

<span class="s2">        and the value of the parameter can later be changed on AI Inference Server.</span>

<span class="s2">        Args:</span>

<span class="s2">            name (str): Name of the parameter</span>

<span class="s2">            desc (str): Description of the parameter (optional)</span>

<span class="s2">            type_name (str, optional): Data type of the parameter. Defaults to &quot;</span><span class="k">String</span><span class="s2">&quot;.</span>

<span class="s2">            default_value (str): Default value of the parameter</span>

<span class="s2">            topic_based (bool, optional): If true, the parameter can be updated from a message queue.</span>

<span class="s2">        Raises:</span>

<span class="s2">            ValueError:</span>

<span class="s2">                When:</span>

<span class="s2">                - the default value of the parameter is not of the specified data type (`type_name`) or</span>

<span class="s2">                - the specified data type itself is not an allowed data type (not a part of `parameter_types` dict) or</span>

<span class="s2">                - the specified data type is not given in the right format or</span>

<span class="s2">                - the type of the given `topic_based` parameter is not `bool`.</span>

<span class="s2">                - the name of the parameter starts with `__AI_IS_` prefix. These are reserved parameters by AI Inference Server</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="n">parameter_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="s2">&quot;String&quot;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;str&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;Integer&quot;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;int&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;Double&quot;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;float&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;Boolean&quot;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bool&#39;</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="n">default_value_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">type</span><span class="p">(</span><span class="n">default_value</span><span class="p">).</span><span class="n">__name__</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">name</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__AI_IS_&quot;</span><span class="p">)</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="s2">&quot;Pipeline parameters with `__AI_IS_` prefix should not be specified in the pipeline configuration. However, the entrypoint script should be able to handle them in the `update_parameters` method.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">type_name</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">parameter_types</span><span class="p">.</span><span class="k">keys</span><span class="p">()</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The given value type is not supported. Please use one of these: {parameter_types.keys()}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">default_value_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">parameter_types</span><span class="err">[</span><span class="n">type_name</span><span class="err">]</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The given value type does not match the type of &#39;{type_name}&#39;. Please use the correct one from these: {list(parameter_types.keys())}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">topic_based</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="s2">&quot;Type of the given `topic_based` parameter is not `bool`.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">parameters</span><span class="err">[</span><span class="k">name</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">name</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">type_name</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;defaultValue&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">default_value</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;topicBased&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">topic_based</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;valueTopic&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">None</span><span class="o">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">parameters</span><span class="err">[</span><span class="k">name</span><span class="err">][</span><span class="s2">&quot;desc&quot;</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">desc</span>
</code></pre></div>

</details>
<h4 id="add_timeshifting_reference">add_timeshifting_reference</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_timeshifting_reference</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Enables signal alignment mode <code>Signal reference</code> by declaring input variables as reference variables.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>reference</td>
<td>str</td>
<td>Variable name to be added to <code>self.timeshift_reference</code> list.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_timeshifting_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">reference</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Enables signal alignment mode `Signal reference` by declaring input variables as reference variables.</span>

<span class="sd">        Args:</span>

<span class="sd">            reference (str): Variable name to be added to `self.timeshift_reference` list.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;There is no input variable defined with name &#39;{reference}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Reference variable with name &#39;{reference}&#39; has been already added.&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="add_wiring">add_wiring</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_wiring</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_input</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Creates a one-to-one connection between the input and output of two components.</p>
<p>The method checks if the connection is allowed with the following requirements:</p>
<ul>
<li>The components exist with the given inputs/outputs</li>
<li>The given inputs and outputs are not connected to any wire</li>
<li>The types of the connected input and output are compatible</li>
</ul>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>from_component</td>
<td>str</td>
<td>Name of the component which provides data to the <code>to_component</code></td>
<td>None</td>
</tr>
<tr>
<td>from_output</td>
<td>str</td>
<td>Name of the output variable of the <code>from_component</code></td>
<td>None</td>
</tr>
<tr>
<td>to_component</td>
<td>str</td>
<td>Name of the component which consumes data from the <code>from_component</code></td>
<td>None</td>
</tr>
<tr>
<td>to_input</td>
<td>str</td>
<td>Name of the input variable of the <code>to_component</code></td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_wiring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">from_component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">from_output</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">to_component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">to_input</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Creates a one-to-one connection between the input and output of two components.</span>

<span class="sd">        The method checks if the connection is allowed with the following requirements:</span>

<span class="sd">        - The components exist with the given inputs/outputs</span>

<span class="sd">        - The given inputs and outputs are not connected to any wire</span>

<span class="sd">        - The types of the connected input and output are compatible</span>

<span class="sd">        Args:</span>

<span class="sd">            from_component (str): Name of the component which provides data to the `to_component`</span>

<span class="sd">            from_output (str): Name of the output variable of the `from_component`</span>

<span class="sd">            to_component (str): Name of the component which consumes data from the `from_component`</span>

<span class="sd">            to_input (str): Name of the input variable of the `to_component`</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">from_component</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No component named &#39;{from_component}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">to_component</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No component named &#39;{to_component}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">from_output</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">from_component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Component &#39;{from_component}&#39; has no output named &#39;{from_output}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">to_input</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">to_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Component &#39;{to_component}&#39; has no input named &#39;{to_input}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">to_component</span><span class="p">,</span><span class="w"> </span><span class="n">to_input</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Input &#39;{to_input}&#39; of component &#39;{to_component}&#39; is already wired&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">_output_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">from_component</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">from_output</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

<span class="w">        </span><span class="n">_input_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">to_component</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">to_input</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">_output_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">_input_type</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;Output and input types do not match&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">wire_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_wire_hash_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_component</span><span class="p">,</span><span class="w"> </span><span class="n">from_output</span><span class="p">,</span><span class="w"> </span><span class="n">to_component</span><span class="p">,</span><span class="w"> </span><span class="n">to_input</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="p">[</span><span class="n">wire_hash</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="s2">&quot;fromComponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">from_component</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;fromOutput&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">from_output</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;toComponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">to_component</span><span class="p">,</span>

<span class="w">            </span><span class="s2">&quot;toInput&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">to_input</span><span class="p">,</span>

<span class="w">        </span><span class="p">}</span>
</code></pre></div>

</details>
<h4 id="delete_input">delete_input</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_input</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Deletes a pipeline input.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component</td>
<td>str</td>
<td>Name of the component</td>
<td>None</td>
</tr>
<tr>
<td>variable</td>
<td>str</td>
<td>Name of the input variable</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">delete_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes a pipeline input.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline input does not exist.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="delete_input_wire">delete_input_wire</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_input_wire</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">with_input</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<p>Deletes an existing connection between two components.</p>
<p>The connection must be given with the name of the consumer component and its input variable.
If an inter signal alignment reference variable is affected it cannot be deleted.
By default, the input variable will be also deleted.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component</td>
<td>str</td>
<td>Name of the component which has the input given the name variable</td>
<td>None</td>
</tr>
<tr>
<td>variable</td>
<td>str</td>
<td>Name of the input variable on the component which connected by the wire</td>
<td>None</td>
</tr>
<tr>
<td>with_input</td>
<td>bool</td>
<td>If set, the input variable will be also deleted from the component. Defaults to True.</td>
<td>True</td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AssertionError</td>
<td>When the variable acts as inter signal alignment reference, it cannot be deleted, and an <code>AssertionError</code> will be raised.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">delete_input_wire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">with_input</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes an existing connection between two components.</span>

<span class="sd">        The connection must be given with the name of the consumer component and its input variable.</span>

<span class="sd">        If an inter signal alignment reference variable is affected it cannot be deleted.</span>

<span class="sd">        By default, the input variable will be also deleted.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component which has the input given the name variable</span>

<span class="sd">            variable (str): Name of the input variable on the component which connected by the wire</span>

<span class="sd">            with_input (bool, optional): If set, the input variable will be also deleted from the component. Defaults to True.</span>

<span class="sd">        Raises:</span>

<span class="sd">            AssertionError: When the variable acts as inter signal alignment reference, it cannot be deleted, and an `AssertionError` will be raised.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">wire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">wire</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;There is no wiring for input &#39;{variable}&#39; of component &#39;{component}&#39;&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeshift_reference</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;Inter signal alignment reference variables can not be deleted.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">wire_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_wire_hash_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromComponent&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;fromOutput&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toComponent&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">wire</span><span class="p">[</span><span class="s1">&#39;toInput&#39;</span><span class="p">])</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">wiring</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">wire_hash</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">with_input</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">delete_input</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="delete_output">delete_output</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_output</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Deletes a pipeline output.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component</td>
<td>str</td>
<td>Name of the component</td>
<td>None</td>
</tr>
<tr>
<td>variable</td>
<td>str</td>
<td>Name of the input variable</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">delete_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deletes a pipeline output.</span>

<span class="sd">        Args:</span>

<span class="sd">            component (str): Name of the component</span>

<span class="sd">            variable (str): Name of the input variable</span>

<span class="sd">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">)</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;The pipeline output does not exist.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="export">export</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="n">package_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
</code></pre></div>

<p>Export a runnable pipeline package.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>destination</td>
<td>str</td>
<td>optional target directory for saving the package. Defaults to ".".</td>
<td>"."</td>
</tr>
<tr>
<td>package_id</td>
<td>UUID</td>
<td>optional package ID. If None, a new UUID is generated.</td>
<td>None</td>
</tr>
<tr>
<td>version</td>
<td>str</td>
<td>optional version. If None, an automatic version number is generated.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">export</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">package_id</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">uuid.UUID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">Path</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Export a runnable pipeline package.</span>

<span class="ss">        Args:</span>

<span class="ss">            destination (str): optional target directory for saving the package. Defaults to &quot;</span><span class="p">.</span><span class="ss">&quot;.</span>

<span class="ss">            package_id (UUID): optional package ID. If None, a new UUID is generated.</span>

<span class="ss">            version (str): optional version. If None, an automatic version number is generated.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">config_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">config_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="k">save</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span><span class="w"> </span><span class="n">package_id</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)</span>

<span class="w">            </span><span class="n">runtime_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convert_package</span><span class="p">(</span><span class="n">config_package</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">report_writer</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">runtime_package</span>

<span class="w">        </span><span class="nl">finally</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">config_package</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">                </span><span class="k">Path</span><span class="p">(</span><span class="n">config_package</span><span class="p">).</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="get_datalink_metadata">get_datalink_metadata</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_datalink_metadata</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>The method generates metadata information based on available information.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>dict</td>
<td>Dictionary with the necessary information for the AI Inference Server.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_datalink_metadata</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        The method generates metadata information based on available information.</span>

<span class="ss">        Returns:</span>

<span class="ss">            dict: Dictionary with the necessary information for the AI Inference Server.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">timeshifting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="ss">&quot;id&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;enabled&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;periodicity&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">periodicity</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;startingPoint&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">periodicity</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">timeshifting</span><span class="o">[</span><span class="n">&quot;enabled&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span>

<span class="w">            </span><span class="n">timeshifting</span><span class="o">[</span><span class="n">&quot;startingPoint&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;First timestamp&#39;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">timeshift_reference</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">            </span><span class="n">timeshifting</span><span class="o">[</span><span class="n">&quot;startingPoint&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Signal reference&#39;</span>

<span class="w">        </span><span class="n">exported_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="ss">&quot;fileFormatVersion&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;1.0.0&quot;</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;id&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;version&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;createdOn&quot;</span><span class="err">:</span><span class="w"> </span><span class="nc">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span>

<span class="w">            </span><span class="ss">&quot;updatedOn&quot;</span><span class="err">:</span><span class="w"> </span><span class="nc">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span>

<span class="w">            </span><span class="ss">&quot;timeShifting&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">timeshifting</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;inputs&quot;</span><span class="err">:</span><span class="w"> </span><span class="o">[</span>

<span class="n">                {</span>

<span class="n">                    &#39;name&#39;: _name,</span>

<span class="n">                    &#39;mapping&#39;: None,</span>

<span class="n">                    &#39;timeShiftingReference&#39;: _name in self.timeshift_reference,</span>

<span class="n">                    &#39;type&#39;: self.components[_component</span><span class="o">]</span><span class="p">.</span><span class="n">inputs</span><span class="o">[</span><span class="n">_name</span><span class="o">][</span><span class="n">&#39;type&#39;</span><span class="o">]</span>

<span class="w">                </span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_component</span><span class="p">,</span><span class="w"> </span><span class="n">_name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">inputs</span>

<span class="w">            </span><span class="err">]</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">exported_metadata</span>
</code></pre></div>

</details>
<h4 id="get_pipeline_config">get_pipeline_config</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_pipeline_config</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>

<p>Saves the information on the composed pipeline configuration package into a YAML file.</p>
<p>This YAML file describes the components and the data flow between them for the AI Inference Server.
The file is created in the <code>destination</code> folder with name <code>pipeline_config.yml</code></p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_pipeline_config</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Saves the information on the composed pipeline configuration package into a YAML file.</span>

<span class="ss">        This YAML file describes the components and the data flow between them for the AI Inference Server.</span>

<span class="ss">        The file is created in the `destination` folder with name `pipeline_config.yml`</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">init_version</span>

<span class="w">        </span><span class="n">filtered_pipeline_outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">(component_name, name) for component_name, name in self.outputs if self.components[component_name</span><span class="o">]</span><span class="p">.</span><span class="n">outputs</span><span class="o">[</span><span class="n">name</span><span class="o">][</span><span class="n">&#39;type&#39;</span><span class="o">]</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;imageset&#39;</span><span class="err">]</span>

<span class="w">        </span><span class="n">metric_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">(component_name, field) for component_name, component in self.components.items() if isinstance(component, PythonComponent) for field in component.metrics.keys()</span><span class="o">]</span>

<span class="w">        </span><span class="n">pipeline_inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">{</span>

<span class="n">            &#39;name&#39;: name,</span>

<span class="n">            &#39;type&#39;: self.components[component_name</span><span class="o">]</span><span class="p">.</span><span class="n">inputs</span><span class="o">[</span><span class="n">name</span><span class="o">][</span><span class="n">&#39;type&#39;</span><span class="o">]</span>

<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">inputs</span><span class="err">]</span>

<span class="w">        </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">{</span>

<span class="n">            &#39;name&#39;: name,</span>

<span class="n">            &#39;type&#39;: self.components[component_name</span><span class="o">]</span><span class="p">.</span><span class="n">outputs</span><span class="o">[</span><span class="n">name</span><span class="o">][</span><span class="n">&#39;type&#39;</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="s1">&#39;metric&#39;</span><span class="err">:</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>

<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component_name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">filtered_pipeline_outputs</span><span class="err">]</span>

<span class="w">        </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">[</span><span class="n">{</span>

<span class="n">            &#39;name&#39;: field,</span>

<span class="n">            &#39;type&#39;: &#39;String&#39;,</span>

<span class="n">            &#39;metric&#39;: True,</span>

<span class="n">            &#39;topic&#39;: f&quot;/siemens/edge/aiinference/{self.name}/{version}/metrics/{component_name}/{field}&quot;,</span>

<span class="n">        } for component_name, field in metric_fields</span><span class="o">]</span>

<span class="w">        </span><span class="n">pipeline_dag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">{</span>

<span class="n">            &#39;source&#39;: f&quot;{wire[&#39;fromComponent&#39;</span><span class="o">]</span><span class="err">}</span><span class="p">.</span><span class="err">{</span><span class="n">wire</span><span class="o">[</span><span class="n">&#39;fromOutput&#39;</span><span class="o">]</span><span class="err">}</span><span class="ss">&quot;,</span>

<span class="ss">            &#39;target&#39;: f&quot;</span><span class="err">{</span><span class="n">wire</span><span class="o">[</span><span class="n">&#39;toComponent&#39;</span><span class="o">]</span><span class="err">}</span><span class="p">.</span><span class="err">{</span><span class="n">wire</span><span class="o">[</span><span class="n">&#39;toInput&#39;</span><span class="o">]</span><span class="err">}</span><span class="ss">&quot;,</span>

<span class="ss">        } for wire in self.wiring.values()]</span>

<span class="ss">        pipeline_dag += [{</span>

<span class="ss">            &#39;source&#39;: f&#39;Databus.{name}&#39;,</span>

<span class="ss">            &#39;target&#39;: f&#39;{component_name}.{name}&#39;,</span>

<span class="ss">        } for component_name, name in self.inputs]</span>

<span class="ss">        pipeline_dag += [{</span>

<span class="ss">            &#39;source&#39;: f&#39;{component_name}.{name}&#39;,</span>

<span class="ss">            &#39;target&#39;: f&#39;Databus.{name}&#39;,</span>

<span class="ss">        } for component_name, name in filtered_pipeline_outputs]</span>

<span class="ss">        pipeline_dag += [{</span>

<span class="ss">            &#39;source&#39;: f&#39;{component_name}.{field}&#39;,</span>

<span class="ss">            &#39;target&#39;: f&#39;Databus.{field}&#39;,</span>

<span class="ss">        } for component_name, field in metric_fields]</span>

<span class="ss">        config_yml_content = {</span>

<span class="ss">            &#39;fileFormatVersion&#39;: &#39;1.2.0&#39;,</span>

<span class="ss">            &#39;dataFlowPipelineInfo&#39;: {</span>

<span class="ss">                &#39;author&#39;: self.author,</span>

<span class="ss">                &#39;createdOn&#39;: datetime.now(),</span>

<span class="ss">                &#39;dataFlowPipelineVersion&#39;: version,</span>

<span class="ss">                &#39;description&#39;: self.desc if self.desc else &#39;Created by AI SDK&#39;,</span>

<span class="ss">                &#39;projectName&#39;: self.name,</span>

<span class="ss">                &#39;packageId&#39;: str(self.package_id)</span>

<span class="ss">            },</span>

<span class="ss">            &#39;dataFlowPipeline&#39;: {</span>

<span class="ss">                &#39;components&#39;: [component._to_dict() for component in self.components.values()],</span>

<span class="ss">                &#39;pipelineDag&#39;: pipeline_dag,</span>

<span class="ss">                &#39;pipelineInputs&#39;: pipeline_inputs,</span>

<span class="ss">                &#39;pipelineOutputs&#39;: pipeline_outputs,</span>

<span class="ss">            },</span>

<span class="ss">            &#39;packageType&#39;: &#39;full&#39;</span>

<span class="ss">        }</span>

<span class="ss">        if len(self.parameters.items()) != 0:</span>

<span class="ss">            config_yml_content[&quot;</span><span class="n">dataFlowPipeline</span><span class="ss">&quot;][&quot;</span><span class="n">pipelineParameters</span><span class="ss">&quot;] = []</span>

<span class="ss">            for name, parameter in self.parameters.items():</span>

<span class="ss">                if parameter[&quot;</span><span class="n">topicBased</span><span class="ss">&quot;]:</span>

<span class="ss">                    config_yml_content[&quot;</span><span class="n">dataFlowPipeline</span><span class="ss">&quot;][&quot;</span><span class="n">pipelineParameters</span><span class="ss">&quot;].append({</span>

<span class="ss">                        &#39;name&#39;: name, &#39;type&#39;: parameter[&#39;type&#39;],</span>

<span class="ss">                        &#39;defaultValue&#39;: parameter[&#39;defaultValue&#39;],</span>

<span class="ss">                        &#39;topicBased&#39;: parameter[&#39;topicBased&#39;], &#39;valueTopic&#39;: parameter[&#39;valueTopic&#39;]</span>

<span class="ss">                    })</span>

<span class="ss">                else:</span>

<span class="ss">                    config_yml_content[&quot;</span><span class="n">dataFlowPipeline</span><span class="ss">&quot;][&quot;</span><span class="n">pipelineParameters</span><span class="err">&quot;]</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="err">{</span>

<span class="w">                        </span><span class="s1">&#39;name&#39;</span><span class="err">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;type&#39;</span><span class="err">:</span><span class="w"> </span><span class="k">parameter</span><span class="o">[</span><span class="n">&#39;type&#39;</span><span class="o">]</span><span class="p">,</span>

<span class="w">                        </span><span class="s1">&#39;defaultValue&#39;</span><span class="err">:</span><span class="w"> </span><span class="k">parameter</span><span class="o">[</span><span class="n">&#39;defaultValue&#39;</span><span class="o">]</span>

<span class="w">                    </span><span class="err">}</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">config_yml_content</span>
</code></pre></div>

</details>
<h4 id="get_wire_for_input">get_wire_for_input</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_wire_for_input</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">input_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Searches for the wire which connects a component with <code>component_name</code> as data consumer through its input with name <code>input_name</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component_name</td>
<td>str</td>
<td>Name of the data consumer component.</td>
<td>None</td>
</tr>
<tr>
<td>input_name</td>
<td>str</td>
<td>Name of the input variable of <code>component_name</code>.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>dict</td>
<td>Wire which contains the data provider and receiver with their names and the names of their variables.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_wire_for_input</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">component_name</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">input_name</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Searches for the wire which connects a component with `component_name` as data consumer through its input with name `input_name`.</span>

<span class="s2">        Args:</span>

<span class="s2">            component_name (str): Name of the data consumer component.</span>

<span class="s2">            input_name (str): Name of the input variable of `component_name`.</span>

<span class="s2">        Returns:</span>

<span class="s2">            dict: Wire which contains the data provider and receiver with their names and the names of their variables.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="n">wires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[</span><span class="n">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">wiring</span><span class="p">.</span><span class="k">values</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s2">&quot;toComponent&quot;</span><span class="err">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">component_name</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s2">&quot;toInput&quot;</span><span class="err">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">input_name</span><span class="err">]</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">wires</span><span class="err">[</span><span class="mi">0</span><span class="err">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">wires</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">None</span>
</code></pre></div>

</details>
<h4 id="get_wire_for_output">get_wire_for_output</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_wire_for_output</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Searches for the wire which connects a component with <code>component_name</code> as data provider through its output with name output_name.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>component_name</td>
<td>str</td>
<td>Name of the data provider component.</td>
<td>None</td>
</tr>
<tr>
<td>output_name</td>
<td>str</td>
<td>Name of the output variable of <code>component_name</code>.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[dict]</td>
<td>Wire which contains the data provider and receiver with their names and the names of their variables.</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_wire_for_output</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">component_name</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">output_name</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Searches for the wire which connects a component with `component_name` as data provider through its output with name output_name.</span>

<span class="s2">        Args:</span>

<span class="s2">            component_name (str): Name of the data provider component.</span>

<span class="s2">            output_name (str): Name of the output variable of `component_name`.</span>

<span class="s2">        Returns:</span>

<span class="s2">            [dict]: Wire which contains the data provider and receiver with their names and the names of their variables.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="n">wires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[</span><span class="n">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">wiring</span><span class="p">.</span><span class="k">values</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s2">&quot;fromComponent&quot;</span><span class="err">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">component_name</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s2">&quot;fromOutput&quot;</span><span class="err">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">output_name</span><span class="err">]</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">wires</span><span class="err">[</span><span class="mi">0</span><span class="err">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">wires</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">None</span>
</code></pre></div>

</details>
<h4 id="remove_timeshifting_reference">remove_timeshifting_reference</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_timeshifting_reference</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>

<p>Removes previously-defined inter-signal alignment reference variables.</p>
<p>If no reference variables remain, the <code>startingPoint</code> will be <code>First timestamp</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>reference</td>
<td>str</td>
<td>Variable name to be removed from <code>self.timeshift_reference</code> list.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">remove_timeshifting_reference</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">reference</span><span class="o">:</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Removes previously-defined inter-signal alignment reference variables.</span>

<span class="s2">        If no reference variables remain, the `startingPoint` will be `First timestamp`.</span>

<span class="s2">        Args:</span>

<span class="s2">            reference (str): Variable name to be removed from `self.timeshift_reference` list.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">reference</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">timeshift_reference</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Reference variable with name {&#39;reference&#39;} does not exist.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">timeshift_reference</span><span class="p">.</span><span class="k">remove</span><span class="p">(</span><span class="k">reference</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="save">save</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="n">package_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
</code></pre></div>

<p>@Deprecated, reason: only edge package generation will be supported in the future. Use export instead.</p>
<p>Saves the assembled package in a zip format.
The name of the file is defined as <code>{package_name}_{package_version}.zip</code>.
If a file with such a name already exists in the <code>destination</code> folder, it gets overwritten and a warning message appears.</p>
<p>The package is also available as a subfolder on the destination path with the name <code>{package_name}_{package_version}</code>.
If the assembled content does not meet the expected one, this content can be changed and simply packed into a zip file.</p>
<p>The package contains files and folders in the following structure:</p>
<ul>
<li>
<p>Package folder with name <code>{package_name}_{package_version}</code></p>
<ul>
<li><code>datalink-metadata.yml</code></li>
<li><code>pipeline-config.yml</code></li>
<li>Component folder with name <code>{component_name}</code></li>
</ul>
<p>When the component is a <code>PythonComponent</code>, this folder contains:</p>
<ul>
<li><code>requirements.txt</code></li>
<li>Entrypoint script defined by the entrypoint of the component</li>
<li>Extra files as added to the specified folders</li>
<li>Source folder with name <code>src</code> with necessary python scripts</li>
</ul>
</li>
</ul>
<p>If a package ID is specified, and a package with the same ID and version is already present in the <code>destination</code> folder,
an error is raised.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>destination</td>
<td>str</td>
<td>Target directory for saving the package. Defaults to ".".</td>
<td>"."</td>
</tr>
<tr>
<td>package_id</td>
<td>UUID</td>
<td>The optional package ID. If None, a new UUID is generated.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">package_id</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">uuid.UUID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">Path</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        @Deprecated, reason: only edge package generation will be supported in the future. Use export instead.</span>

<span class="ss">        Saves the assembled package in a zip format.</span>

<span class="ss">        The name of the file is defined as `{package_name}_{package_version}.zip`.</span>

<span class="ss">        If a file with such a name already exists in the `destination` folder, it gets overwritten and a warning message appears.</span>

<span class="ss">        The package is also available as a subfolder on the destination path with the name `{package_name}_{package_version}`.</span>

<span class="ss">        If the assembled content does not meet the expected one, this content can be changed and simply packed into a zip file.</span>

<span class="ss">        The package contains files and folders in the following structure:</span>

<span class="ss">        - Package folder with name `{package_name}_{package_version}`</span>

<span class="ss">            - `datalink-metadata.yml`</span>

<span class="ss">            - `pipeline-config.yml`</span>

<span class="ss">            - Component folder with name `{component_name}`</span>

<span class="ss">            When the component is a `PythonComponent`, this folder contains:</span>

<span class="ss">            - `requirements.txt`</span>

<span class="ss">            - Entrypoint script defined by the entrypoint of the component</span>

<span class="ss">            - Extra files as added to the specified folders</span>

<span class="ss">            - Source folder with name `src` with necessary python scripts</span>

<span class="ss">        If a package ID is specified, and a package with the same ID and version is already present in the `destination` folder,</span>

<span class="ss">        an error is raised.</span>

<span class="ss">        Args:</span>

<span class="ss">            destination (str, optional): Target directory for saving the package. Defaults to &quot;</span><span class="p">.</span><span class="ss">&quot;.</span>

<span class="ss">            package_id (UUID): The optional package ID. If None, a new UUID is generated.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_set_save_version_and_package_id</span><span class="p">(</span><span class="k">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">),</span><span class="w"> </span><span class="n">package_id</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="ss">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;-&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">package_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="ss">&quot;{name}_{self.save_version}&quot;</span>

<span class="w">        </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">package_name</span>

<span class="w">        </span><span class="n">destination</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">exist_ok</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Save</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="k">save</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span><span class="w"> </span><span class="k">False</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">report_writer</span><span class="p">.</span><span class="n">add_direct_dependencies</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">python_dependencies</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">save_datalink_metadata</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">save_pipeline_config</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">p_page</span><span class="p">.</span><span class="n">save_readme_html</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">save_telemetry_data</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<span class="w">        </span><span class="n">zip_destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shutil</span><span class="p">.</span><span class="n">make_archive</span><span class="p">(</span>

<span class="w">            </span><span class="n">base_name</span><span class="o">=</span><span class="nf">str</span><span class="p">(</span><span class="n">destination</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">package_name</span><span class="p">),</span><span class="w"> </span><span class="nf">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span>

<span class="w">            </span><span class="n">root_dir</span><span class="o">=</span><span class="n">destination</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="n">base_dir</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>

<span class="w">            </span><span class="n">verbose</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">_logger</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="k">path</span><span class="p">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">zip_destination</span><span class="p">)</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">zipped</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">bytes</span>

<span class="w">        </span><span class="n">pipeline_size_GB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;{:.2f}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">pipeline_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline_size_limit_GB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;{:.2f}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">PIPELINE_SIZE_LIMIT</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">pipeline_size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">PIPELINE_SIZE_LIMIT</span><span class="p">:</span>

<span class="w">            </span><span class="n">error_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="ss">&quot;Pipeline size {pipeline_size} bytes ({pipeline_size_GB} GB) exceeds the limit of &quot;</span><span class="w"> </span><span class="err">\</span>

<span class="w">                        </span><span class="n">f</span><span class="ss">&quot;{PIPELINE_SIZE_LIMIT} bytes ({pipeline_size_limit_GB} GB). &quot;</span><span class="w"> </span><span class="err">\</span>

<span class="w">                        </span><span class="ss">&quot;Please remove unnecessary files and dependencies and try again.&quot;</span>

<span class="w">            </span><span class="n">_logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">RuntimeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">Path</span><span class="p">(</span><span class="n">zip_destination</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="save_datalink_metadata">save_datalink_metadata</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_datalink_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">destination</span>
<span class="p">)</span>
</code></pre></div>

<p>Saves metadata for pipeline input variables.</p>
<p>This method saves metadata for the AI Inference Server into a YAML file.
This metadata determines how the AI Inference Server feeds input to the pipeline, especially inter-signal alignment.
The file is created in the <code>destination</code> folder with the name <code>datalink_metadata.yml</code></p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>destination</td>
<td>path-like</td>
<td>Path of the destination directory.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save_datalink_metadata</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Saves metadata for pipeline input variables.</span>

<span class="s2">        This method saves metadata for the AI Inference Server into a YAML file.</span>

<span class="s2">        This metadata determines how the AI Inference Server feeds input to the pipeline, especially inter-signal alignment.</span>

<span class="s2">        The file is created in the `destination` folder with the name `datalink_metadata.yml`</span>

<span class="s2">        Args:</span>

<span class="s2">            destination (path-like): Path of the destination directory.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="k">open</span><span class="p">(</span><span class="k">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">DATALINK_METADATA</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="o">:</span>

<span class="w">            </span><span class="n">yaml</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">get_datalink_metadata</span><span class="p">(),</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="save_pipeline_config">save_pipeline_config</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_pipeline_config</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">destination</span>
<span class="p">)</span>
</code></pre></div>

<p>Saves the information about the composed pipeline configuration package into a YAML file.</p>
<p>This YAML file describes the components and the data flow between them for AI Inference Server.
The file will be created in the <code>destination</code> folder with name <code>pipeline_config.yml</code></p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>destination</td>
<td>path-like</td>
<td>Path of the <code>destination</code> directory.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save_pipeline_config</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Saves the information about the composed pipeline configuration package into a YAML file.</span>

<span class="s2">        This YAML file describes the components and the data flow between them for AI Inference Server.</span>

<span class="s2">        The file will be created in the `destination` folder with name `pipeline_config.yml`</span>

<span class="s2">        Args:</span>

<span class="s2">            destination (path-like): Path of the `destination` directory.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="k">open</span><span class="p">(</span><span class="k">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PIPELINE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="o">:</span>

<span class="w">            </span><span class="n">yaml</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">get_pipeline_config</span><span class="p">(),</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="save_telemetry_data">save_telemetry_data</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_telemetry_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">destination</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
<span class="p">)</span>
</code></pre></div>

<p>Save telemetry data to a specified destination.</p>
<p>Args:
    destination (Path): The path where the telemetry data should be saved.</p>
<p>Returns:
    None</p>
<p>Raises:
    None</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save_telemetry_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">destination</span><span class="p">:</span><span class="w"> </span><span class="k">Path</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Save telemetry data to a specified destination.</span>

<span class="ss">        Args:</span>

<span class="ss">            destination (Path): The path where the telemetry data should be saved.</span>

<span class="ss">        Returns:</span>

<span class="ss">            None</span>

<span class="ss">        Raises:</span>

<span class="ss">            None</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">telemetry_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TELEMETRY_YAML</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;platform&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;platform&quot;</span><span class="o">][</span><span class="n">&quot;os&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform</span><span class="p">.</span><span class="k">system</span><span class="p">()</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;platform&quot;</span><span class="o">][</span><span class="n">&quot;release&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform</span><span class="p">.</span><span class="k">release</span><span class="p">()</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;platform&quot;</span><span class="o">][</span><span class="n">&quot;python_version&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">platform</span><span class="p">.</span><span class="n">python_version</span><span class="p">()</span>

<span class="w">        </span><span class="n">_logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;locals: {locals()}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;environment&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;environment&quot;</span><span class="o">][</span><span class="n">&quot;jupyter&quot;</span><span class="o">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="ow">any</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">locals</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;__IPYTHON__&quot;, &quot;get_ipython&quot;</span><span class="o">]</span><span class="p">)</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;environment&quot;</span><span class="o">][</span><span class="n">&quot;gitlab_ci&quot;</span><span class="o">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ss">&quot;GITLAB_CI&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;environment&quot;</span><span class="o">][</span><span class="n">&quot;azure_devops&quot;</span><span class="o">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ss">&quot;TF_BUILD&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;environment&quot;</span><span class="o">][</span><span class="n">&quot;github_actions&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ss">&quot;GITHUB_ACTIONS&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;industrial_ai&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;industrial_ai&quot;</span><span class="o">][</span><span class="n">&quot;simaticai&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;industrial_ai&quot;</span><span class="o">][</span><span class="n">&quot;vep-template-sdk&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MSG_NOT_FOUND</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;industrial_ai&quot;</span><span class="o">][</span><span class="n">&quot;simaticai&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pkg_resources</span><span class="p">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="ss">&quot;simaticai&quot;</span><span class="p">).</span><span class="n">version</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">pkg_resources</span><span class="p">.</span><span class="nl">DistributionNotFound</span><span class="p">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;simaticai package not found&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;industrial_ai&quot;</span><span class="o">][</span><span class="n">&quot;vep-template-sdk&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pkg_resources</span><span class="p">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="ss">&quot;vep-template-sdk&quot;</span><span class="p">).</span><span class="n">version</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">pkg_resources</span><span class="p">.</span><span class="nl">DistributionNotFound</span><span class="p">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;vep-template-sdk package not found&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;pipeline&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;pipeline&quot;</span><span class="o">][</span><span class="n">&quot;python_versions&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="k">set</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">python_version</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">)))</span>

<span class="w">        </span><span class="n">telemetry_data</span><span class="o">[</span><span class="n">&quot;pipeline&quot;</span><span class="o">][</span><span class="n">&quot;file_extensions&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="k">set</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">suffix</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">).</span><span class="n">rglob</span><span class="p">(</span><span class="ss">&quot;*&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">suffix</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;&quot;, &quot;.zip&quot;, &quot;.yml&quot;, &quot;.yaml&quot;, &quot;.html&quot;</span><span class="o">]</span><span class="p">))</span>

<span class="w">        </span><span class="n">yaml</span><span class="p">.</span><span class="k">dump</span><span class="p">(</span><span class="n">telemetry_data</span><span class="p">,</span><span class="w"> </span><span class="k">open</span><span class="p">(</span><span class="n">telemetry_path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
</code></pre></div>

</details>
<h4 id="set_timeshifting_periodicity">set_timeshifting_periodicity</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_timeshifting_periodicity</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">periodicity</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span>
</code></pre></div>

<p>Enables inter-signal alignment with the given sampling period.</p>
<p>With inter-signal alignment enabled, the AI Inference Server collects data for different input variables before it triggers the model.
By default, <code>startingPoint</code> property is set to <code>First timestamp</code>, which means that inter-signal alignment is started at the
first incoming value for any input variable.</p>
<p>This property can be changed to <code>Signal reference</code> by adding inter-signal alignment reference variables
via the <code>add_timeshifting_reference(..)</code> method. In this case, inter-signal alignment is started when the first value arrives
for the defined input variables.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>periodicity</td>
<td>int</td>
<td>Periodicity time in milliseconds for the AI Inference Server to perform inter-signal alignment. Valid range is [10, 2^31).</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">set</span><span class="n">_timeshifting_periodicity</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">periodicity</span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="o">:</span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span>

<span class="s2">        Enables inter-signal alignment with the given sampling period.</span>

<span class="s2">        With inter-signal alignment enabled, the AI Inference Server collects data for different input variables before it triggers the model.</span>

<span class="s2">        By default, `startingPoint` property is set to `First timestamp`, which means that inter-signal alignment is started at the</span>

<span class="s2">        first incoming value for any input variable.</span>

<span class="s2">        This property can be changed to `Signal reference` by adding inter-signal alignment reference variables</span>

<span class="s2">        via the `add_timeshifting_reference(..)` method. In this case, inter-signal alignment is started when the first value arrives</span>

<span class="s2">        for the defined input variables.</span>

<span class="s2">        Args:</span>

<span class="s2">            periodicity (int): Periodicity time in milliseconds for the AI Inference Server to perform inter-signal alignment. Valid range is [10, 2^31).</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="n">periodicity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">periodicity</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">periodicity</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">)))</span><span class="o">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="s2">&quot;Inter signal alignment periodicity must be an integer and in range [10, 2^31)&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">periodicity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periodicity</span>

<span class="w">        </span><span class="n">_logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Inter signal alignment periodicity has been set to {self.periodicity}.&quot;</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="validate">validate</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;.&#39;</span>
<span class="p">)</span>
</code></pre></div>

<p>Validates whether the package configuration is compatible with the expected runtime environment.</p>
<p>The method verifies:</p>
<ul>
<li>If the package has at least one component</li>
<li>If all wires create connections between existing components and their variables</li>
<li>If metadata is defined and valid.</li>
<li>If a package with the same name already exists in the <code>destination</code> folder. In this case a warning message appears and the <code>save(..)</code> method overwrites the existing package.</li>
<li>If the package has multiple components and if they are using the same Python version</li>
</ul>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>destination</td>
<td>str</td>
<td>Path of the expected destination folder. Defaults to ".".</td>
<td>"."</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">validate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="o">=</span><span class="ss">&quot;.&quot;</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Validates whether the package configuration is compatible with the expected runtime environment.</span>

<span class="ss">        The method verifies:</span>

<span class="ss">        - If the package has at least one component</span>

<span class="ss">        - If all wires create connections between existing components and their variables</span>

<span class="ss">        - If metadata is defined and valid.</span>

<span class="ss">        - If a package with the same name already exists in the `destination` folder. In this case a warning message appears and the `save(..)` method overwrites the existing package.</span>

<span class="ss">        - If the package has multiple components and if they are using the same Python version</span>

<span class="ss">        Args:</span>

<span class="ss">            destination (str, optional): Path of the expected destination folder. Defaults to &quot;</span><span class="p">.</span><span class="ss">&quot;.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">save_version</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">init_version</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="ss">&quot;The package must have at least one component.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">outputs</span><span class="p">:</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">name</span><span class="o">]</span><span class="p">.</span><span class="n">batch</span><span class="p">.</span><span class="nl">outputBatch</span><span class="p">:</span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;The component &#39;{name}&#39; has pipeline output defined with variable name &#39;{variable}&#39;. \</span>

<span class="ss">                                      None of component with pipeline output is allowed to provide batch output.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">wire_hash</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">wiring</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span><span class="err">:</span>

<span class="w">            </span><span class="n">wire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">wiring</span><span class="o">[</span><span class="n">wire_hash</span><span class="o">]</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_check_wiring</span><span class="p">(</span><span class="n">wire</span><span class="p">,</span><span class="w"> </span><span class="n">wire_hash</span><span class="p">)</span>

<span class="w">        </span><span class="n">pipeline_inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">variable for _, variable in self.inputs</span><span class="o">]</span>

<span class="w">        </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">variable for _, variable in self.outputs</span><span class="o">]</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">any</span><span class="p">(</span><span class="k">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline_outputs</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">variable</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pipeline_inputs</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">set</span><span class="p">(</span><span class="n">pipeline_inputs</span><span class="p">).</span><span class="k">intersection</span><span class="p">(</span><span class="k">set</span><span class="p">(</span><span class="n">pipeline_outputs</span><span class="p">))</span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">AssertionError</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Pipeline input and output variables must be unique. Conflicting variables: {conflicts}&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_check_timeshifting</span><span class="p">()</span>

<span class="w">        </span><span class="n">package_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="ss">&quot;{self.name}_{version}&quot;</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="ss">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;-&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">package_path</span><span class="p">.</span><span class="n">is_dir</span><span class="p">()</span><span class="err">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Target folder ({package_path}) already exists! Unless changing the package name the package could be invalid and your files will be overwritten!&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">python_versions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">set</span><span class="p">()</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">components</span><span class="p">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">validate</span><span class="p">()</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">PythonComponent</span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="n">python_versions</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="o">[</span><span class="n">component</span><span class="o">]</span><span class="p">.</span><span class="n">python_version</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">python_versions</span><span class="p">))</span><span class="err">:</span>

<span class="w">            </span><span class="n">_logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="ss">&quot;The use of multiple python version in a single pipeline is not recommended. We recommend using only one of the supported versions, which are Python 3.10 or 3.11.&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">_logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Package &#39;{self.name}&#39; is valid and ready to save.&quot;</span><span class="p">)</span>
</code></pre></div>

</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Index" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Index
            </div>
          </div>
        </a>
      
      
        
        <a href="pipeline_data.html" class="md-footer__link md-footer__link--next" aria-label="Next: Pipeline Data" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Pipeline Data
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (C) Siemens AG 2021. All Rights Reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.48f2be22.min.js"></script>
      
    
  </body>
</html>